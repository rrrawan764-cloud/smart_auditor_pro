<!doctype html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رواق العدل - المنصة القانونية الذكية المتكاملة</title>
    
    <!-- الخطوط والأيقونات -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- مكتبات إضافية للوظائف -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    
    <style>
        :root {
            /* الألوان الأساسية */
            --primary: #0a716e;
            --primary-dark: #054a48;
            --primary-light: #0fb06b;
            --primary-gradient: linear-gradient(135deg, #0a716e, #0fb06b);
            
            /* الألوان الثانوية */
            --secondary: #1a237e;
            --secondary-light: #3949ab;
            --secondary-dark: #0d1b5e;
            
            /* ألوان التأكيد */
            --accent: #FFB703;
            --accent-dark: #d59b03;
            --accent-light: #ffd54f;
            
            /* ألوان الحالة */
            --success: #0fb06b;
            --success-light: #66bb6a;
            --warning: #ff9800;
            --warning-light: #ffb74d;
            --danger: #e53935;
            --danger-light: #ef9a9a;
            --info: #2196f3;
            --info-light: #64b5f6;
            
            /* ألوان الخلفية والنص */
            --bg-1: #021a1a;
            --bg-2: #042a28;
            --bg-3: #063733;
            --bg-card: rgba(255, 255, 255, 0.03);
            --bg-card-hover: rgba(255, 255, 255, 0.05);
            --bg-input: rgba(0, 0, 0, 0.2);
            --bg-sidebar: rgba(2, 26, 26, 0.95);
            
            /* ألوان النصوص */
            --text-primary: #eaffef;
            --text-secondary: #a8c7b9;
            --text-muted: #8a9c94;
            --text-light: #ffffff;
            
            /* الظلال */
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.25);
            --shadow-md: 0 8px 32px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 20px 60px rgba(0, 0, 0, 0.6);
            --shadow-card: 0 4px 20px rgba(0, 0, 0, 0.3);
            
            /* الأبعاد والمسافات */
            --radius-sm: 6px;
            --radius: 12px;
            --radius-lg: 18px;
            --radius-xl: 24px;
            
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --spacing-xxl: 48px;
            
            /* التحويلات والحركات */
            --transition-fast: 0.15s ease;
            --transition: 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --transition-slow: 0.5s ease;
            
            /* الأبعاد */
            --sidebar-width: 320px;
            --header-height: 70px;
            --max-width: 1440px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(160deg, var(--bg-1), var(--bg-2), var(--bg-3));
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        body {
            display: flex;
            flex-direction: column;
        }
        
        /* شريط التحميل */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(15, 176, 107, 0.2);
            border-radius: 50%;
            border-top-color: var(--primary-light);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* الرأس */
        .header {
            height: var(--header-height);
            background: rgba(2, 26, 26, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding: 0 var(--spacing-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        
        .header-logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius);
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(15, 176, 107, 0.3);
        }
        
        .logo-text h1 {
            font-size: 20px;
            font-weight: 800;
            background: linear-gradient(90deg, #fff, var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
        }
        
        .logo-text p {
            font-size: 12px;
            color: var(--text-muted);
            margin: 0;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }
        
        /* شريط البحث */
        .search-container {
            position: relative;
            width: 300px;
        }
        
        .search-input {
            width: 100%;
            padding: 10px 45px 10px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            color: var(--text-primary);
            font-family: 'Cairo', sans-serif;
            transition: var(--transition);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(15, 176, 107, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }
        
        /* صورة المستخدم */
        .user-profile {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .user-profile:hover {
            background: rgba(255, 255, 255, 0.08);
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 14px;
        }
        
        .user-info {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
        }
        
        .user-role {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        /* المحتوى الرئيسي */
        .main-content {
            flex: 1;
            margin-top: var(--header-height);
            display: flex;
            min-height: calc(100vh - var(--header-height));
        }
        
        /* الشريط الجانبي */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--bg-sidebar);
            border-left: 1px solid rgba(255, 255, 255, 0.05);
            height: calc(100vh - var(--header-height));
            position: fixed;
            left: 0;
            top: var(--header-height);
            overflow-y: auto;
            transition: var(--transition);
            z-index: 900;
        }
        
        .sidebar-menu {
            padding: var(--spacing-lg);
        }
        
        .menu-section {
            margin-bottom: var(--spacing-xl);
        }
        
        .menu-section h3 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: var(--spacing-md);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .menu-items {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--radius);
            transition: var(--transition);
            cursor: pointer;
            border: none;
            background: none;
            font-family: 'Cairo', sans-serif;
            font-size: 15px;
            text-align: right;
        }
        
        .menu-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }
        
        .menu-item.active {
            background: rgba(15, 176, 107, 0.1);
            color: var(--text-primary);
            border-right: 3px solid var(--primary-light);
        }
        
        .menu-item i {
            width: 24px;
            font-size: 18px;
        }
        
        /* المحتوى */
        .content-area {
            flex: 1;
            margin-right: var(--sidebar-width);
            padding: var(--spacing-xl);
            overflow-y: auto;
        }
        
        /* البطاقات */
        .card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            border: 1px solid rgba(255, 255, 255, 0.05);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-card);
            transition: var(--transition);
        }
        
        .card:hover {
            border-color: rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-md);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
        }
        
        .card-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }
        
        .card-subtitle {
            color: var(--text-muted);
            font-size: 15px;
            margin-top: var(--spacing-xs);
        }
        
        /* الأزرار */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: 10px 20px;
            border-radius: var(--radius);
            border: none;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
        }
        
        .btn-primary {
            background: var(--primary-gradient);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(15, 176, 107, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .btn-accent {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: #071018;
        }
        
        .btn-accent:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 183, 3, 0.3);
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 13px;
        }
        
        /* النماذج */
        .form-group {
            margin-bottom: var(--spacing-lg);
        }
        
        .form-label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-input);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            color: var(--text-primary);
            font-family: 'Cairo', sans-serif;
            font-size: 15px;
            transition: var(--transition);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(15, 176, 107, 0.1);
        }
        
        textarea.form-control {
            min-height: 150px;
            resize: vertical;
        }
        
        /* الإحصائيات */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius);
            padding: var(--spacing-lg);
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: rgba(15, 176, 107, 0.2);
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }
        
        .stat-label {
            color: var(--text-muted);
            font-size: 14px;
        }
        
        /* القضايا */
        .cases-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--spacing-lg);
        }
        
        .cases-table th {
            text-align: right;
            padding: var(--spacing-md);
            background: rgba(0, 0, 0, 0.2);
            color: var(--text-primary);
            font-weight: 600;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .cases-table td {
            padding: var(--spacing-md);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .cases-table tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }
        
        .case-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-open { background: rgba(33, 150, 243, 0.15); color: #64b5f6; }
        .status-in-progress { background: rgba(255, 152, 0, 0.15); color: #ffb74d; }
        .status-closed { background: rgba(15, 176, 107, 0.15); color: #66bb6a; }
        .status-urgent { background: rgba(229, 57, 53, 0.15); color: #ef9a9a; }
        
        /* الشعارات */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-primary { background: rgba(15, 176, 107, 0.15); color: #66bb6a; }
        .badge-secondary { background: rgba(26, 35, 126, 0.15); color: #7986cb; }
        .badge-warning { background: rgba(255, 152, 0, 0.15); color: #ffb74d; }
        
        /* التبويبات */
        .tabs {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding-bottom: var(--spacing-sm);
        }
        
        .tab {
            padding: var(--spacing-sm) var(--spacing-lg);
            background: none;
            border: none;
            color: var(--text-secondary);
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }
        
        .tab:hover {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.05);
        }
        
        .tab.active {
            color: var(--text-primary);
            background: rgba(15, 176, 107, 0.1);
            border-bottom: 2px solid var(--primary-light);
        }
        
        /* النماذج المنبثقة */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }
        
        .modal-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }
        
        .modal-body {
            padding: var(--spacing-lg);
        }
        
        .modal-footer {
            padding: var(--spacing-lg);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-md);
        }
        
        /* التنبيهات */
        .alert {
            padding: var(--spacing-md);
            border-radius: var(--radius);
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }
        
        .alert-success {
            background: rgba(15, 176, 107, 0.15);
            border: 1px solid rgba(15, 176, 107, 0.3);
            color: #66bb6a;
        }
        
        .alert-warning {
            background: rgba(255, 152, 0, 0.15);
            border: 1px solid rgba(255, 152, 0, 0.3);
            color: #ffb74d;
        }
        
        .alert-danger {
            background: rgba(229, 57, 53, 0.15);
            border: 1px solid rgba(229, 57, 53, 0.3);
            color: #ef9a9a;
        }
        
        .alert-info {
            background: rgba(33, 150, 243, 0.15);
            border: 1px solid rgba(33, 150, 243, 0.3);
            color: #64b5f6;
        }
        
        /* الـ Toast */
        .toast-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .toast {
            padding: 12px 20px;
            border-radius: var(--radius);
            background: rgba(10, 113, 110, 0.9);
            color: white;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-md);
            animation: slideInLeft 0.3s ease;
            max-width: 350px;
        }
        
        .toast-success { background: rgba(15, 176, 107, 0.9); }
        .toast-warning { background: rgba(255, 152, 0, 0.9); }
        .toast-danger { background: rgba(229, 57, 53, 0.9); }
        .toast-info { background: rgba(33, 150, 243, 0.9); }
        
        @keyframes slideInLeft {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* مساعد الذكاء الاصطناعي */
        .ai-chat-container {
            display: flex;
            flex-direction: column;
            height: 600px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            overflow: hidden;
        }
        
        .ai-chat-header {
            padding: var(--spacing-md);
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .ai-chat-messages {
            flex: 1;
            padding: var(--spacing-lg);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }
        
        .ai-message {
            padding: var(--spacing-md);
            border-radius: var(--radius);
            max-width: 80%;
        }
        
        .ai-message.user {
            background: rgba(15, 176, 107, 0.2);
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        
        .ai-message.assistant {
            background: rgba(255, 255, 255, 0.05);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }
        
        .ai-chat-input {
            padding: var(--spacing-md);
            background: rgba(0, 0, 0, 0.3);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: var(--spacing-md);
        }
        
        .ai-chat-input textarea {
            flex: 1;
            min-height: 60px;
            max-height: 120px;
        }
        
        /* السحب والإفلات */
        .drop-zone {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: var(--radius);
            padding: var(--spacing-xl);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .drop-zone:hover {
            border-color: var(--primary-light);
            background: rgba(15, 176, 107, 0.05);
        }
        
        .drop-zone.dragover {
            border-color: var(--primary-light);
            background: rgba(15, 176, 107, 0.1);
        }
        
        /* التجاوب */
        @media (max-width: 1200px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.show {
                transform: translateX(0);
            }
            
            .content-area {
                margin-right: 0;
            }
            
            .header-actions .search-container {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .header {
                padding: 0 var(--spacing-md);
            }
            
            .content-area {
                padding: var(--spacing-md);
            }
            
            .card {
                padding: var(--spacing-lg);
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
            }
        }
        
        /* فئات المساعدة */
        .d-flex { display: flex; }
        .d-none { display: none; }
        .flex-column { flex-direction: column; }
        .justify-between { justify-content: space-between; }
        .align-center { align-items: center; }
        .gap-1 { gap: var(--spacing-sm); }
        .gap-2 { gap: var(--spacing-md); }
        .gap-3 { gap: var(--spacing-lg); }
        .w-100 { width: 100%; }
        .mt-1 { margin-top: var(--spacing-sm); }
        .mt-2 { margin-top: var(--spacing-md); }
        .mt-3 { margin-top: var(--spacing-lg); }
        .mb-1 { margin-bottom: var(--spacing-sm); }
        .mb-2 { margin-bottom: var(--spacing-md); }
        .mb-3 { margin-bottom: var(--spacing-lg); }
        .text-center { text-align: center; }
        .text-muted { color: var(--text-muted); }
        .text-primary { color: var(--text-primary); }
        .text-success { color: var(--success); }
        .text-danger { color: var(--danger); }
        
        /* شريط التقدم */
        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            overflow: hidden;
            margin: var(--spacing-md) 0;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--primary-gradient);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <!-- شريط التحميل -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>
    
    <!-- الرأس -->
    <header class="header">
        <div class="header-logo">
            <div class="logo-icon">
                <i class="fas fa-balance-scale"></i>
            </div>
            <div class="logo-text">
                <h1>رواق العدل</h1>
                <p>المنصة القانونية الذكية المتكاملة</p>
            </div>
        </div>
        
        <div class="header-actions">
            <div class="search-container">
                <input type="text" class="search-input" id="globalSearch" placeholder="بحث في القضايا والمستندات...">
                <i class="fas fa-search search-icon"></i>
            </div>
            
            <div class="user-profile" id="userProfile">
                <div class="user-avatar">ق</div>
                <div class="user-info">
                    <div class="user-name">القاضي أحمد محمد</div>
                    <div class="user-role">محكمة الاستئناف</div>
                </div>
                <i class="fas fa-chevron-down"></i>
            </div>
        </div>
    </header>
    
    <!-- المحتوى الرئيسي -->
    <div class="main-content">
        <!-- الشريط الجانبي -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-menu">
                <div class="menu-section">
                    <h3>القضايا</h3>
                    <div class="menu-items">
                        <button class="menu-item active" data-view="dashboard">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>لوحة التحكم</span>
                        </button>
                        <button class="menu-item" data-view="cases">
                            <i class="fas fa-gavel"></i>
                            <span>جميع القضايا</span>
                            <span class="badge badge-primary" id="casesCount">0</span>
                        </button>
                        <button class="menu-item" data-view="new-case">
                            <i class="fas fa-file-circle-plus"></i>
                            <span>قيد دعوى جديدة</span>
                        </button>
                        <button class="menu-item" data-view="urgent-cases">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>القضايا العاجلة</span>
                            <span class="badge badge-danger" id="urgentCount">0</span>
                        </button>
                    </div>
                </div>
                
                <div class="menu-section">
                    <h3>المساعد الذكي</h3>
                    <div class="menu-items">
                        <button class="menu-item" data-view="ai-assistant">
                            <i class="fas fa-robot"></i>
                            <span>المساعد القانوني</span>
                        </button>
                        <button class="menu-item" data-view="ai-analysis">
                            <i class="fas fa-brain"></i>
                            <span>تحليل القضايا</span>
                        </button>
                        <button class="menu-item" data-view="precedents">
                            <i class="fas fa-scale-balanced"></i>
                            <span>السوابق القضائية</span>
                        </button>
                        <button class="menu-item" data-view="documents">
                            <i class="fas fa-file-contract"></i>
                            <span>مولد المستندات</span>
                        </button>
                    </div>
                </div>
                
                <div class="menu-section">
                    <h3>إدارة النظام</h3>
                    <div class="menu-items">
                        <button class="menu-item" data-view="judges">
                            <i class="fas fa-user-tie"></i>
                            <span>إدارة القضاة</span>
                        </button>
                        <button class="menu-item" data-view="users">
                            <i class="fas fa-users"></i>
                            <span>المستخدمين</span>
                        </button>
                        <button class="menu-item" data-view="settings">
                            <i class="fas fa-cog"></i>
                            <span>الإعدادات</span>
                        </button>
                        <button class="menu-item" data-view="reports">
                            <i class="fas fa-chart-bar"></i>
                            <span>التقارير والإحصائيات</span>
                        </button>
                    </div>
                </div>
                
                <div class="menu-section">
                    <h3>الجلسات والمواعيد</h3>
                    <div class="menu-items">
                        <button class="menu-item" data-view="sessions">
                            <i class="fas fa-calendar-alt"></i>
                            <span>جدول الجلسات</span>
                        </button>
                        <button class="menu-item" data-view="calendar">
                            <i class="fas fa-calendar-day"></i>
                            <span>التقويم</span>
                        </button>
                        <button class="menu-item" data-view="notifications">
                            <i class="fas fa-bell"></i>
                            <span>الإشعارات</span>
                            <span class="badge badge-warning" id="notificationsCount">0</span>
                        </button>
                    </div>
                </div>
            </div>
        </nav>
        
        <!-- منطقة المحتوى -->
        <main class="content-area" id="contentArea">
            <!-- لوحة التحكم (الواجهة الافتراضية) -->
            <div class="view active" id="view-dashboard">
                <div class="card">
                    <div class="card-header">
                        <div>
                            <h2 class="card-title">مرحباً بك في رواق العدل</h2>
                            <p class="card-subtitle">المنصة القانونية الذكية المتكاملة لإدارة القضايا</p>
                        </div>
                        <div class="d-flex align-center gap-2">
                            <button class="btn btn-primary" id="quickAnalysis">
                                <i class="fas fa-bolt"></i> تحليل سريع
                            </button>
                            <button class="btn btn-secondary" id="quickCase">
                                <i class="fas fa-plus"></i> قضية جديدة
                            </button>
                        </div>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalCasesStat">0</div>
                            <div class="stat-label">إجمالي القضايا</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="openCasesStat">0</div>
                            <div class="stat-label">قضايا مفتوحة</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="urgentCasesStat">0</div>
                            <div class="stat-label">عاجلة</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="assignedCasesStat">0</div>
                            <div class="stat-label">معينة لك</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">القضايا الأخيرة</h3>
                        <button class="btn btn-secondary btn-small" id="viewAllCases">
                            عرض الكل
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="cases-table" id="recentCasesTable">
                            <thead>
                                <tr>
                                    <th>رقم القضية</th>
                                    <th>الموضوع</th>
                                    <th>المدعي</th>
                                    <th>تاريخ الإنشاء</th>
                                    <th>الحالة</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="recentCasesBody">
                                <!-- سيتم تعبئتها عبر JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">الجلسات القادمة</h3>
                    </div>
                    <div id="upcomingSessions">
                        <!-- سيتم تعبئتها عبر JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- عرض جميع القضايا -->
            <div class="view" id="view-cases">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">جميع القضايا</h2>
                        <div class="d-flex align-center gap-2">
                            <button class="btn btn-primary" id="addCaseBtn">
                                <i class="fas fa-plus"></i> إضافة قضية
                            </button>
                            <button class="btn btn-secondary" id="filterCasesBtn">
                                <i class="fas fa-filter"></i> تصفية
                            </button>
                            <button class="btn btn-secondary" id="exportCasesBtn">
                                <i class="fas fa-download"></i> تصدير
                            </button>
                        </div>
                    </div>
                    
                    <div class="tabs">
                        <button class="tab active" data-filter="all">الكل</button>
                        <button class="tab" data-filter="open">مفتوحة</button>
                        <button class="tab" data-filter="in-progress">قيد النظر</button>
                        <button class="tab" data-filter="closed">منتهية</button>
                        <button class="tab" data-filter="urgent">عاجلة</button>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="cases-table" id="allCasesTable">
                            <thead>
                                <tr>
                                    <th>رقم القضية</th>
                                    <th>الموضوع</th>
                                    <th>المدعي</th>
                                    <th>المدعى عليه</th>
                                    <th>تاريخ الإنشاء</th>
                                    <th>الحالة</th>
                                    <th>القاضي</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="allCasesBody">
                                <!-- سيتم تعبئتها عبر JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="d-flex justify-between align-center mt-3">
                        <div class="text-muted" id="casesInfo">عرض 0 من 0 قضية</div>
                        <div class="d-flex gap-1">
                            <button class="btn btn-secondary btn-small" id="prevPage">السابق</button>
                            <button class="btn btn-secondary btn-small" id="nextPage">التالي</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- قيد دعوى جديدة -->
            <div class="view" id="view-new-case">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">قيد دعوى جديدة</h2>
                        <p class="card-subtitle">املأ النموذج لإضافة قضية جديدة للنظام</p>
                    </div>
                    
                    <form id="newCaseForm">
                        <div class="form-group">
                            <label class="form-label">بيانات المدعي</label>
                            <div class="d-flex gap-2">
                                <input type="text" class="form-control" id="plaintiffName" placeholder="اسم المدعي" required>
                                <input type="text" class="form-control" id="plaintiffId" placeholder="رقم الهوية">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">بيانات المدعى عليه</label>
                            <div class="d-flex gap-2">
                                <input type="text" class="form-control" id="defendantName" placeholder="اسم المدعى عليه" required>
                                <input type="text" class="form-control" id="defendantId" placeholder="رقم الهوية">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">تفاصيل القضية</label>
                            <input type="text" class="form-control" id="caseSubject" placeholder="موضوع القضية" required>
                            <textarea class="form-control mt-1" id="caseDescription" placeholder="تفاصيل القضية والوقائع..." rows="4" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">تصنيف القضية</label>
                            <div class="d-flex gap-2">
                                <select class="form-control" id="caseType" required>
                                    <option value="">اختر نوع القضية</option>
                                    <option value="civil">مدنية</option>
                                    <option value="commercial">تجارية</option>
                                    <option value="criminal">جنائية</option>
                                    <option value="administrative">إدارية</option>
                                    <option value="labor">عمالية</option>
                                    <option value="family">أحوال شخصية</option>
                                </select>
                                <select class="form-control" id="casePriority" required>
                                    <option value="">اختر الأولوية</option>
                                    <option value="normal">عادية</option>
                                    <option value="high">متوسطة</option>
                                    <option value="urgent">عاجلة</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">المرفقات</label>
                            <div class="drop-zone" id="fileDropZone">
                                <i class="fas fa-cloud-upload-alt fa-2x mb-2"></i>
                                <p>اسحب الملفات هنا أو انقر للاختيار</p>
                                <p class="text-muted mt-1">الحد الأقصى: 10 ملفات، 50 ميجابايت لكل ملف</p>
                                <input type="file" id="fileInput" multiple style="display: none;">
                            </div>
                            <div id="fileList" class="mt-2"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">القاضي المعين</label>
                            <select class="form-control" id="assignedJudge">
                                <option value="">اختياري - سيتم التعيين لاحقاً</option>
                            </select>
                        </div>
                        
                        <div class="d-flex justify-between mt-3">
                            <button type="button" class="btn btn-secondary" id="saveDraftBtn">حفظ كمسودة</button>
                            <button type="submit" class="btn btn-primary" id="submitCaseBtn">
                                <i class="fas fa-save"></i> حفظ القضية
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- المساعد الذكي -->
            <div class="view" id="view-ai-assistant">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">المساعد القانوني الذكي</h2>
                        <p class="card-subtitle">اطرح أسئلتك القانونية واحصل على إجابات ذكية</p>
                    </div>
                    
                    <div class="ai-chat-container">
                        <div class="ai-chat-header">
                            <div class="d-flex justify-between align-center">
                                <div>
                                    <h4>المساعد القانوني</h4>
                                    <p class="text-muted">متصل وجاهز للإجابة على أسئلتك</p>
                                </div>
                                <div class="d-flex gap-1">
                                    <button class="btn btn-secondary btn-small" id="clearChat">
                                        <i class="fas fa-trash"></i> مسح المحادثة
                                    </button>
                                    <button class="btn btn-primary btn-small" id="newTopic">
                                        <i class="fas fa-plus"></i> موضوع جديد
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="ai-chat-messages" id="chatMessages">
                            <div class="ai-message assistant">
                                <strong>المساعد القانوني:</strong>
                                <p>مرحباً بك! أنا مساعدك القانوني الذكي. كيف يمكنني مساعدتك اليوم؟</p>
                                <p class="text-muted mt-1">يمكنني مساعدتك في:</p>
                                <ul class="text-muted">
                                    <li>تحليل القضايا القانونية</li>
                                    <li>كتابة المذكرات والمستندات</li>
                                    <li>البحث في السوابق القضائية</li>
                                    <li>الإجابة على الاستفسارات القانونية</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="ai-chat-input">
                            <textarea class="form-control" id="chatInput" placeholder="اكتب سؤالك القانوني هنا..." rows="2"></textarea>
                            <button class="btn btn-primary" id="sendMessage">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <h4>أسئلة شائعة</h4>
                        <div class="d-flex flex-wrap gap-2 mt-2">
                            <button class="btn btn-secondary btn-small quick-question" data-question="كيفية كتابة مذكرة دفاع؟">
                                كيفية كتابة مذكرة دفاع؟
                            </button>
                            <button class="btn btn-secondary btn-small quick-question" data-question="ما هي إجراءات الطعن في الحكم؟">
                                ما هي إجراءات الطعن في الحكم؟
                            </button>
                            <button class="btn btn-secondary btn-small quick-question" data-question="كيفية تحليل قضية مدنية؟">
                                كيفية تحليل قضية مدنية؟
                            </button>
                            <button class="btn btn-secondary btn-small quick-question" data-question="ما هي مدة التقادم في القضايا التجارية؟">
                                ما هي مدة التقادم في القضايا التجارية؟
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- تحليل القضايا بالذكاء الاصطناعي -->
            <div class="view" id="view-ai-analysis">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">تحليل القضايا بالذكاء الاصطناعي</h2>
                        <p class="card-subtitle">قم بتحميل القضية للحصول على تحليل ذكي وتوصيات</p>
                    </div>
                    
                    <div class="tabs">
                        <button class="tab active" data-analysis-type="upload">تحميل قضية</button>
                        <button class="tab" data-analysis-type="select">اختيار قضية</button>
                        <button class="tab" data-analysis-type="batch">تحليل جماعي</button>
                    </div>
                    
                    <div id="analysis-upload" class="analysis-section">
                        <div class="form-group">
                            <label class="form-label">تحميل ملفات القضية</label>
                            <div class="drop-zone" id="analysisDropZone">
                                <i class="fas fa-file-upload fa-2x mb-2"></i>
                                <p>اسحب ملفات القضية هنا أو انقر للاختيار</p>
                                <p class="text-muted mt-1">يدعم: PDF, DOC, DOCX, TXT (الحد الأقصى: 100 ميجابايت)</p>
                                <input type="file" id="analysisFileInput" multiple style="display: none;">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">أو أدخل نص القضية يدوياً</label>
                            <textarea class="form-control" id="analysisText" placeholder="الصق نص القضية هنا..." rows="8"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">نوع التحليل</label>
                            <div class="d-flex flex-wrap gap-2">
                                <button class="btn btn-secondary analysis-type active" data-type="legal">تحليل قانوني</button>
                                <button class="btn btn-secondary analysis-type" data-type="procedural">إجراءات قضائية</button>
                                <button class="btn btn-secondary analysis-type" data-type="precedent">سوابق قضائية</button>
                                <button class="btn btn-secondary analysis-type" data-type="risk">تحليل المخاطر</button>
                                <button class="btn btn-secondary analysis-type" data-type="comprehensive">تحليل شامل</button>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary w-100" id="startAnalysis">
                            <i class="fas fa-play"></i> بدء التحليل
                        </button>
                    </div>
                    
                    <div id="analysis-select" class="analysis-section d-none">
                        <div class="form-group">
                            <label class="form-label">اختر قضية للتحليل</label>
                            <select class="form-control" id="caseSelect">
                                <option value="">اختر قضية...</option>
                            </select>
                        </div>
                        
                        <div id="selectedCaseInfo" class="d-none">
                            <!-- سيتم تعبئتها عبر JavaScript -->
                        </div>
                    </div>
                    
                    <div id="analysis-results" class="d-none">
                        <div class="card-header">
                            <h3 class="card-title">نتائج التحليل</h3>
                            <div class="d-flex gap-2">
                                <button class="btn btn-secondary btn-small" id="exportAnalysis">
                                    <i class="fas fa-download"></i> تصدير
                                </button>
                                <button class="btn btn-secondary btn-small" id="printAnalysis">
                                    <i class="fas fa-print"></i> طباعة
                                </button>
                            </div>
                        </div>
                        
                        <div id="analysisResultsContent">
                            <!-- سيتم تعبئتها عبر JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- عرض إدارة القضاة -->
            <div class="view" id="view-judges">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">إدارة القضاة</h2>
                        <button class="btn btn-primary" id="addJudgeBtn">
                            <i class="fas fa-plus"></i> إضافة قاضٍ
                        </button>
                    </div>
                    
                    <div id="judgesList">
                        <!-- سيتم تعبئتها عبر JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- عرض التقارير والإحصائيات -->
            <div class="view" id="view-reports">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">التقارير والإحصائيات</h2>
                        <div class="d-flex gap-2">
                            <select class="form-control" id="reportPeriod" style="width: 200px;">
                                <option value="today">اليوم</option>
                                <option value="week">الأسبوع</option>
                                <option value="month" selected>الشهر</option>
                                <option value="quarter">الربع</option>
                                <option value="year">السنة</option>
                            </select>
                            <button class="btn btn-primary" id="generateReport">
                                <i class="fas fa-chart-bar"></i> توليد التقرير
                            </button>
                        </div>
                    </div>
                    
                    <div id="reportsContent">
                        <!-- سيتم تعبئتها عبر JavaScript -->
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- النماذج المنبثقة -->
    
    <!-- نموذج إضافة قاضٍ -->
    <div class="modal" id="addJudgeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">إضافة قاضٍ جديد</h3>
                <button class="btn btn-secondary btn-small" id="closeJudgeModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="judgeForm">
                    <div class="form-group">
                        <label class="form-label">الاسم الكامل</label>
                        <input type="text" class="form-control" id="judgeName" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">الدرجة الوظيفية</label>
                        <select class="form-control" id="judgeRank" required>
                            <option value="">اختر الدرجة</option>
                            <option value="chief">رئيس محكمة</option>
                            <option value="vice_chief">نائب رئيس</option>
                            <option value="judge">قاضٍ</option>
                            <option value="assistant">قاضٍ مساعد</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">المحكمة</label>
                        <input type="text" class="form-control" id="judgeCourt" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">التخصصات</label>
                        <div class="d-flex flex-wrap gap-2" id="specialtiesContainer">
                            <label class="badge badge-secondary" style="cursor: pointer;">
                                <input type="checkbox" name="specialties" value="civil"> مدني
                            </label>
                            <label class="badge badge-secondary" style="cursor: pointer;">
                                <input type="checkbox" name="specialties" value="commercial"> تجاري
                            </label>
                            <label class="badge badge-secondary" style="cursor: pointer;">
                                <input type="checkbox" name="specialties" value="criminal"> جنائي
                            </label>
                            <label class="badge badge-secondary" style="cursor: pointer;">
                                <input type="checkbox" name="specialties" value="administrative"> إداري
                            </label>
                            <label class="badge badge-secondary" style="cursor: pointer;">
                                <input type="checkbox" name="specialties" value="labor"> عمّالي
                            </label>
                            <label class="badge badge-secondary" style="cursor: pointer;">
                                <input type="checkbox" name="specialties" value="family"> أحوال شخصية
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">البريد الإلكتروني</label>
                        <input type="email" class="form-control" id="judgeEmail">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">رقم الهاتف</label>
                        <input type="tel" class="form-control" id="judgePhone">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelJudgeBtn">إلغاء</button>
                <button class="btn btn-primary" id="saveJudgeBtn">حفظ</button>
            </div>
        </div>
    </div>
    
    <!-- نموذج تفاصيل القضية -->
    <div class="modal" id="caseDetailsModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title" id="caseDetailsTitle">تفاصيل القضية</h3>
                <button class="btn btn-secondary btn-small" id="closeCaseModal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="caseDetailsContent">
                    <!-- سيتم تعبئتها عبر JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeCaseDetailsBtn">إغلاق</button>
                <button class="btn btn-primary" id="editCaseBtn">تعديل</button>
                <button class="btn btn-accent" id="analyzeCaseBtn">تحليل بالذكاء الاصطناعي</button>
            </div>
        </div>
    </div>
    
    <!-- نموذج تحليل سريع -->
    <div class="modal" id="quickAnalysisModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">تحليل سريع</h3>
                <button class="btn btn-secondary btn-small" id="closeQuickAnalysis">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">أدخل نص القضية للتحليل السريع</label>
                    <textarea class="form-control" id="quickAnalysisText" placeholder="الصق نص القضية هنا..." rows="6"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">نوع التحليل</label>
                    <select class="form-control" id="quickAnalysisType">
                        <option value="summary">ملخص سريع</option>
                        <option value="issues">المسائل القانونية</option>
                        <option value="procedures">الإجراءات المطلوبة</option>
                        <option value="recommendations">التوصيات</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelQuickAnalysis">إلغاء</button>
                <button class="btn btn-primary" id="runQuickAnalysis">تشغيل التحليل</button>
            </div>
        </div>
    </div>
    
    <!-- حاوية التنبيهات -->
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- مكتبات JavaScript -->
    <script>
        // ============================================
        // نظام التخزين المحلي (يمكن استبداله بقاعدة بيانات حقيقية)
        // ============================================
        
        class Database {
            constructor() {
                this.initDatabase();
            }
            
            initDatabase() {
                // تهيئة قواعد البيانات المحلية إذا لم تكن موجودة
                const databases = ['cases', 'judges', 'users', 'sessions', 'documents', 'analysis', 'notifications', 'settings'];
                
                databases.forEach(db => {
                    if (!localStorage.getItem(`rwaq_${db}`)) {
                        localStorage.setItem(`rwaq_${db}`, JSON.stringify([]));
                    }
                });
                
                // تهيئة البيانات الأولية إذا كانت فارغة
                this.initSampleData();
            }
            
            initSampleData() {
                // بيانات القضايا
                let cases = this.getCases();
                if (cases.length === 0) {
                    const sampleCases = [
                        {
                            id: this.generateId(),
                            caseNumber: '2024/CIV/001',
                            plaintiffName: 'محمد أحمد السالم',
                            plaintiffId: '1234567890',
                            defendantName: 'شركة التقنية المتقدمة',
                            defendantId: 'CR123456',
                            subject: 'مطالبة بتعويض عن ضرر مادي',
                            description: 'مطالبة بتعويض عن أضرار مادية ناتجة عن عيب في المنتج تسبب في خسائر مالية للمدعي',
                            type: 'civil',
                            priority: 'urgent',
                            status: 'open',
                            assignedJudge: 'القاضي أحمد محمد',
                            createdDate: new Date().toISOString(),
                            lastUpdated: new Date().toISOString(),
                            attachments: [],
                            notes: [],
                            sessions: [
                                {
                                    date: new Date(Date.now() + 86400000 * 7).toISOString(),
                                    type: 'جلسة أولى',
                                    status: 'مجدولة'
                                }
                            ]
                        },
                        {
                            id: this.generateId(),
                            caseNumber: '2024/COM/001',
                            plaintiffName: 'شركة الأماني للتجارة',
                            plaintiffId: 'CR987654',
                            defendantName: 'مؤسسة النهضة للمقاولات',
                            defendantId: 'CR654321',
                            subject: 'نزاع تعاقدي حول تنفيذ مشروع',
                            description: 'نزاع حول تنفيذ عقد مقاولة بقيمة 2 مليون ريال، حيث يدعي المدعي عدم تنفيذ العقد بالشروط المتفق عليها',
                            type: 'commercial',
                            priority: 'high',
                            status: 'in-progress',
                            assignedJudge: 'القاضي سعيد العتيبي',
                            createdDate: new Date(Date.now() - 86400000 * 15).toISOString(),
                            lastUpdated: new Date().toISOString(),
                            attachments: [
                                { name: 'العقد الأصلي.pdf', size: '2.5 MB', uploaded: new Date().toISOString() },
                                { name: 'المراسلات.docx', size: '1.2 MB', uploaded: new Date().toISOString() }
                            ],
                            notes: [
                                {
                                    content: 'تم استلام المستندات المبدئية',
                                    author: 'القاضي أحمد محمد',
                                    date: new Date(Date.now() - 86400000 * 5).toISOString()
                                }
                            ],
                            sessions: [
                                {
                                    date: new Date(Date.now() - 86400000 * 10).toISOString(),
                                    type: 'جلسة تمهيدية',
                                    status: 'منعقدة'
                                },
                                {
                                    date: new Date(Date.now() + 86400000 * 14).toISOString(),
                                    type: 'جلسة سماع شهود',
                                    status: 'مجدولة'
                                }
                            ]
                        },
                        {
                            id: this.generateId(),
                            caseNumber: '2024/CRI/001',
                            plaintiffName: 'النائب العام',
                            plaintiffId: 'GOV001',
                            defendantName: 'علي محمود حسن',
                            defendantId: '1234567891',
                            subject: 'قضية اختلاس أموال عامة',
                            description: 'قضية جنائية تتعلق باختلاس أموال عامة بقيمة 500 ألف ريال من مؤسسة حكومية',
                            type: 'criminal',
                            priority: 'high',
                            status: 'open',
                            assignedJudge: 'القاضي خالد الفهد',
                            createdDate: new Date(Date.now() - 86400000 * 3).toISOString(),
                            lastUpdated: new Date().toISOString(),
                            attachments: [
                                { name: 'التقرير المالي.pdf', size: '3.1 MB', uploaded: new Date().toISOString() },
                                { name: 'محضر الضبط.pdf', size: '1.8 MB', uploaded: new Date().toISOString() }
                            ],
                            notes: [],
                            sessions: [
                                {
                                    date: new Date(Date.now() + 86400000 * 21).toISOString(),
                                    type: 'جلسة النطق بالحكم',
                                    status: 'مجدولة'
                                }
                            ]
                        }
                    ];
                    
                    sampleCases.forEach(caseData => {
                        cases.push(caseData);
                    });
                    
                    this.saveCases(cases);
                }
                
                // بيانات القضاة
                let judges = this.getJudges();
                if (judges.length === 0) {
                    const sampleJudges = [
                        {
                            id: this.generateId(),
                            name: 'القاضي أحمد محمد',
                            rank: 'رئيس محكمة',
                            court: 'محكمة الاستئناف - الرياض',
                            specialties: ['civil', 'commercial', 'administrative'],
                            email: 'ahmed.mohammed@court.gov.sa',
                            phone: '+966501234567',
                            activeCases: 12,
                            totalCases: 245,
                            status: 'active'
                        },
                        {
                            id: this.generateId(),
                            name: 'القاضي سعيد العتيبي',
                            rank: 'قاضٍ',
                            court: 'المحكمة التجارية - جدة',
                            specialties: ['commercial', 'labor'],
                            email: 'saed.alotaibi@court.gov.sa',
                            phone: '+966502345678',
                            activeCases: 8,
                            totalCases: 187,
                            status: 'active'
                        },
                        {
                            id: this.generateId(),
                            name: 'القاضي خالد الفهد',
                            rank: 'قاضٍ',
                            court: 'المحكمة الجزائية - الدمام',
                            specialties: ['criminal'],
                            email: 'khaled.alfahd@court.gov.sa',
                            phone: '+966503456789',
                            activeCases: 15,
                            totalCases: 312,
                            status: 'active'
                        }
                    ];
                    
                    sampleJudges.forEach(judge => {
                        judges.push(judge);
                    });
                    
                    this.saveJudges(judges);
                }
                
                // بيانات الجلسات
                let sessions = this.getSessions();
                if (sessions.length === 0) {
                    const sampleSessions = [
                        {
                            id: this.generateId(),
                            caseNumber: '2024/CIV/001',
                            caseSubject: 'مطالبة بتعويض عن ضرر مادي',
                            date: new Date(Date.now() + 86400000 * 7).toISOString(),
                            time: '09:00',
                            type: 'جلسة أولى',
                            courtroom: 'القاعة ٣',
                            judge: 'القاضي أحمد محمد',
                            status: 'مجدولة'
                        },
                        {
                            id: this.generateId(),
                            caseNumber: '2024/COM/001',
                            caseSubject: 'نزاع تعاقدي حول تنفيذ مشروع',
                            date: new Date(Date.now() + 86400000 * 14).toISOString(),
                            time: '10:30',
                            type: 'جلسة سماع شهود',
                            courtroom: 'القاعة ٥',
                            judge: 'القاضي سعيد العتيبي',
                            status: 'مجدولة'
                        },
                        {
                            id: this.generateId(),
                            caseNumber: '2024/CRI/001',
                            caseSubject: 'قضية اختلاس أموال عامة',
                            date: new Date(Date.now() + 86400000 * 21).toISOString(),
                            time: '14:00',
                            type: 'جلسة النطق بالحكم',
                            courtroom: 'القاعة ١',
                            judge: 'القاضي خالد الفهد',
                            status: 'مجدولة'
                        }
                    ];
                    
                    sampleSessions.forEach(session => {
                        sessions.push(session);
                    });
                    
                    this.saveSessions(sessions);
                }
            }
            
            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }
            
            // ========== عمليات القضايا ==========
            
            getCases(filter = 'all') {
                const cases = JSON.parse(localStorage.getItem('rwaq_cases') || '[]');
                
                if (filter === 'all') return cases;
                
                return cases.filter(c => {
                    if (filter === 'open') return c.status === 'open';
                    if (filter === 'in-progress') return c.status === 'in-progress';
                    if (filter === 'closed') return c.status === 'closed';
                    if (filter === 'urgent') return c.priority === 'urgent';
                    return true;
                });
            }
            
            getCaseById(id) {
                const cases = this.getCases();
                return cases.find(c => c.id === id);
            }
            
            getCaseByNumber(caseNumber) {
                const cases = this.getCases();
                return cases.find(c => c.caseNumber === caseNumber);
            }
            
            saveCases(cases) {
                localStorage.setItem('rwaq_cases', JSON.stringify(cases));
            }
            
            addCase(caseData) {
                const cases = this.getCases();
                caseData.id = this.generateId();
                caseData.createdDate = new Date().toISOString();
                caseData.lastUpdated = new Date().toISOString();
                caseData.status = caseData.status || 'open';
                cases.push(caseData);
                this.saveCases(cases);
                
                // إضافة إشعار
                this.addNotification({
                    title: 'قضية جديدة',
                    message: `تمت إضافة القضية ${caseData.caseNumber}`,
                    type: 'info',
                    read: false,
                    date: new Date().toISOString()
                });
                
                return caseData;
            }
            
            updateCase(id, updates) {
                const cases = this.getCases();
                const index = cases.findIndex(c => c.id === id);
                
                if (index !== -1) {
                    updates.lastUpdated = new Date().toISOString();
                    cases[index] = { ...cases[index], ...updates };
                    this.saveCases(cases);
                    
                    // إضافة إشعار
                    this.addNotification({
                        title: 'تحديث قضية',
                        message: `تم تحديث القضية ${cases[index].caseNumber}`,
                        type: 'info',
                        read: false,
                        date: new Date().toISOString()
                    });
                    
                    return cases[index];
                }
                
                return null;
            }
            
            deleteCase(id) {
                const cases = this.getCases();
                const filtered = cases.filter(c => c.id !== id);
                this.saveCases(filtered);
                return filtered.length !== cases.length;
            }
            
            // ========== عمليات القضاة ==========
            
            getJudges() {
                return JSON.parse(localStorage.getItem('rwaq_judges') || '[]');
            }
            
            getJudgeById(id) {
                const judges = this.getJudges();
                return judges.find(j => j.id === id);
            }
            
            saveJudges(judges) {
                localStorage.setItem('rwaq_judges', JSON.stringify(judges));
            }
            
            addJudge(judgeData) {
                const judges = this.getJudges();
                judgeData.id = this.generateId();
                judgeData.activeCases = judgeData.activeCases || 0;
                judgeData.totalCases = judgeData.totalCases || 0;
                judgeData.status = judgeData.status || 'active';
                judges.push(judgeData);
                this.saveJudges(judges);
                return judgeData;
            }
            
            updateJudge(id, updates) {
                const judges = this.getJudges();
                const index = judges.findIndex(j => j.id === id);
                
                if (index !== -1) {
                    judges[index] = { ...judges[index], ...updates };
                    this.saveJudges(judges);
                    return judges[index];
                }
                
                return null;
            }
            
            // ========== عمليات الجلسات ==========
            
            getSessions() {
                return JSON.parse(localStorage.getItem('rwaq_sessions') || '[]');
            }
            
            saveSessions(sessions) {
                localStorage.setItem('rwaq_sessions', JSON.stringify(sessions));
            }
            
            addSession(sessionData) {
                const sessions = this.getSessions();
                sessionData.id = this.generateId();
                sessions.push(sessionData);
                this.saveSessions(sessions);
                return sessionData;
            }
            
            // ========== عمليات الإشعارات ==========
            
            getNotifications() {
                return JSON.parse(localStorage.getItem('rwaq_notifications') || '[]');
            }
            
            addNotification(notification) {
                const notifications = this.getNotifications();
                notification.id = this.generateId();
                notifications.unshift(notification);
                localStorage.setItem('rwaq_notifications', JSON.stringify(notifications));
                return notification;
            }
            
            markNotificationAsRead(id) {
                const notifications = this.getNotifications();
                const index = notifications.findIndex(n => n.id === id);
                if (index !== -1) {
                    notifications[index].read = true;
                    localStorage.setItem('rwaq_notifications', JSON.stringify(notifications));
                }
            }
            
            // ========== عمليات التحليل ==========
            
            saveAnalysis(analysisData) {
                const analyses = JSON.parse(localStorage.getItem('rwaq_analysis') || '[]');
                analysisData.id = this.generateId();
                analysisData.date = new Date().toISOString();
                analyses.unshift(analysisData);
                localStorage.setItem('rwaq_analysis', JSON.stringify(analyses));
                return analysisData;
            }
            
            getAnalyses() {
                return JSON.parse(localStorage.getItem('rwaq_analysis') || '[]');
            }
            
            // ========== إحصائيات ==========
            
            getStatistics() {
                const cases = this.getCases();
                const judges = this.getJudges();
                const sessions = this.getSessions();
                
                const totalCases = cases.length;
                const openCases = cases.filter(c => c.status === 'open').length;
                const urgentCases = cases.filter(c => c.priority === 'urgent').length;
                const assignedCases = cases.filter(c => c.assignedJudge === 'القاضي أحمد محمد').length;
                
                const today = new Date().toISOString().split('T')[0];
                const todaysSessions = sessions.filter(s => s.date.split('T')[0] === today);
                
                const unreadNotifications = this.getNotifications().filter(n => !n.read).length;
                
                return {
                    totalCases,
                    openCases,
                    urgentCases,
                    assignedCases,
                    todaysSessions: todaysSessions.length,
                    totalJudges: judges.length,
                    unreadNotifications
                };
            }
        }
        
        // ============================================
        // نظام التطبيق الرئيسي
        // ============================================
        
        class RwaqApp {
            constructor() {
                this.db = new Database();
                this.currentView = 'dashboard';
                this.currentUser = {
                    name: 'القاضي أحمد محمد',
                    role: 'قاضٍ',
                    court: 'محكمة الاستئناف - الرياض'
                };
                
                this.init();
            }
            
            init() {
                this.bindEvents();
                this.loadDashboard();
                this.updateStats();
                this.loadJudges();
                this.setupFileUpload();
                this.setupChat();
                
                // إخفاء شاشة التحميل بعد 1.5 ثانية
                setTimeout(() => {
                    document.getElementById('loadingOverlay').style.display = 'none';
                }, 1500);
            }
            
            bindEvents() {
                // التنقل في الشريط الجانبي
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        const view = e.currentTarget.dataset.view;
                        this.switchView(view);
                    });
                });
                
                // البحث العام
                document.getElementById('globalSearch').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.performSearch(e.target.value);
                    }
                });
                
                // الأزرار في لوحة التحكم
                document.getElementById('quickAnalysis').addEventListener('click', () => {
                    this.showQuickAnalysis();
                });
                
                document.getElementById('quickCase').addEventListener('click', () => {
                    this.switchView('new-case');
                });
                
                document.getElementById('viewAllCases').addEventListener('click', () => {
                    this.switchView('cases');
                });
                
                // إضافة قضية
                document.getElementById('addCaseBtn').addEventListener('click', () => {
                    this.switchView('new-case');
                });
                
                document.getElementById('newCaseForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.submitNewCase();
                });
                
                document.getElementById('saveDraftBtn').addEventListener('click', () => {
                    this.saveCaseAsDraft();
                });
                
                // التبويبات في عرض القضايا
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const filter = e.currentTarget.dataset.filter;
                        this.filterCases(filter);
                    });
                });
                
                // إدارة القضاة
                document.getElementById('addJudgeBtn').addEventListener('click', () => {
                    this.showAddJudgeModal();
                });
                
                document.getElementById('saveJudgeBtn').addEventListener('click', () => {
                    this.saveJudge();
                });
                
                document.getElementById('closeJudgeModal').addEventListener('click', () => {
                    this.hideAddJudgeModal();
                });
                
                document.getElementById('cancelJudgeBtn').addEventListener('click', () => {
                    this.hideAddJudgeModal();
                });
                
                // التحليل السريع
                document.getElementById('runQuickAnalysis').addEventListener('click', () => {
                    this.runQuickAnalysis();
                });
                
                document.getElementById('closeQuickAnalysis').addEventListener('click', () => {
                    this.hideQuickAnalysisModal();
                });
                
                document.getElementById('cancelQuickAnalysis').addEventListener('click', () => {
                    this.hideQuickAnalysisModal();
                });
                
                // المساعد الذكي
                document.getElementById('sendMessage').addEventListener('click', () => {
                    this.sendChatMessage();
                });
                
                document.getElementById('chatInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendChatMessage();
                    }
                });
                
                document.querySelectorAll('.quick-question').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const question = e.currentTarget.dataset.question;
                        this.askQuickQuestion(question);
                    });
                });
                
                document.getElementById('clearChat').addEventListener('click', () => {
                    this.clearChat();
                });
                
                document.getElementById('newTopic').addEventListener('click', () => {
                    this.clearChat();
                });
                
                // تحليل القضايا
                document.getElementById('startAnalysis').addEventListener('click', () => {
                    this.startAnalysis();
                });
                
                // التبويبات في تحليل القضايا
                document.querySelectorAll('[data-analysis-type]').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const type = e.currentTarget.dataset.analysisType;
                        this.switchAnalysisTab(type);
                    });
                });
                
                // نوع التحليل
                document.querySelectorAll('.analysis-type').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.analysis-type').forEach(b => b.classList.remove('active'));
                        e.currentTarget.classList.add('active');
                    });
                });
                
                // إغلاق النماذج المنبثقة بالنقر خارجها
                window.addEventListener('click', (e) => {
                    if (e.target.classList.contains('modal')) {
                        e.target.classList.remove('show');
                    }
                });
            }
            
            switchView(view) {
                // تحديث القائمة النشطة
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.view === view) {
                        item.classList.add('active');
                    }
                });
                
                // إخفاء جميع المشاهد
                document.querySelectorAll('.view').forEach(v => {
                    v.classList.remove('active');
                });
                
                // إظهار المشهد المطلوب
                const targetView = document.getElementById(`view-${view}`);
                if (targetView) {
                    targetView.classList.add('active');
                    this.currentView = view;
                    
                    // تحميل البيانات الخاصة بالمشهد
                    switch(view) {
                        case 'dashboard':
                            this.loadDashboard();
                            this.updateStats();
                            break;
                        case 'cases':
                            this.loadAllCases();
                            break;
                        case 'new-case':
                            this.prepareNewCaseForm();
                            break;
                        case 'ai-assistant':
                            this.loadChatHistory();
                            break;
                        case 'ai-analysis':
                            this.loadCasesForAnalysis();
                            break;
                        case 'judges':
                            this.loadJudges();
                            break;
                        case 'reports':
                            this.loadReports();
                            break;
                    }
                }
            }
            
            // ========== لوحة التحكم ==========
            
            loadDashboard() {
                this.loadRecentCases();
                this.loadUpcomingSessions();
            }
            
            loadRecentCases() {
                const cases = this.db.getCases().slice(0, 5);
                const tbody = document.getElementById('recentCasesBody');
                
                if (cases.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center text-muted">
                                لا توجد قضايا حديثة
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = cases.map(caseItem => `
                    <tr>
                        <td><strong>${caseItem.caseNumber}</strong></td>
                        <td>${caseItem.subject}</td>
                        <td>${caseItem.plaintiffName}</td>
                        <td>${this.formatDate(caseItem.createdDate)}</td>
                        <td>
                            <span class="case-status ${this.getStatusClass(caseItem.status)}">
                                ${this.getStatusText(caseItem.status)}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-secondary btn-small view-case" data-id="${caseItem.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
                
                // إضافة مستمعي الأحداث لأزرار عرض القضية
                document.querySelectorAll('.view-case').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const caseId = e.currentTarget.dataset.id;
                        this.showCaseDetails(caseId);
                    });
                });
            }
            
            loadUpcomingSessions() {
                const sessions = this.db.getSessions().slice(0, 3);
                const container = document.getElementById('upcomingSessions');
                
                if (sessions.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-muted p-3">
                            لا توجد جلسات قادمة
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = sessions.map(session => `
                    <div class="d-flex justify-between align-center p-3 border-bottom border-dark">
                        <div>
                            <div><strong>${session.caseNumber}</strong></div>
                            <div class="text-muted">${session.caseSubject}</div>
                        </div>
                        <div class="text-right">
                            <div>${this.formatDate(session.date)} ${session.time}</div>
                            <div class="text-muted">${session.courtroom}</div>
                        </div>
                    </div>
                `).join('');
            }
            
            updateStats() {
                const stats = this.db.getStatistics();
                
                document.getElementById('totalCasesStat').textContent = stats.totalCases;
                document.getElementById('openCasesStat').textContent = stats.openCases;
                document.getElementById('urgentCasesStat').textContent = stats.urgentCases;
                document.getElementById('assignedCasesStat').textContent = stats.assignedCases;
                
                // تحديث العداد في القائمة الجانبية
                document.getElementById('casesCount').textContent = stats.totalCases;
                document.getElementById('urgentCount').textContent = stats.urgentCases;
                document.getElementById('notificationsCount').textContent = stats.unreadNotifications;
            }
            
            // ========== إدارة القضايا ==========
            
            loadAllCases(filter = 'all') {
                const cases = this.db.getCases(filter);
                const tbody = document.getElementById('allCasesBody');
                
                if (cases.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="8" class="text-center text-muted">
                                لا توجد قضايا
                            </td>
                        </tr>
                    `;
                    document.getElementById('casesInfo').textContent = 'عرض 0 من 0 قضية';
                    return;
                }
                
                tbody.innerHTML = cases.map(caseItem => `
                    <tr>
                        <td><strong>${caseItem.caseNumber}</strong></td>
                        <td>${caseItem.subject}</td>
                        <td>${caseItem.plaintiffName}</td>
                        <td>${caseItem.defendantName}</td>
                        <td>${this.formatDate(caseItem.createdDate)}</td>
                        <td>
                            <span class="case-status ${this.getStatusClass(caseItem.status)}">
                                ${this.getStatusText(caseItem.status)}
                            </span>
                        </td>
                        <td>${caseItem.assignedJudge || 'غير معين'}</td>
                        <td>
                            <button class="btn btn-secondary btn-small view-case" data-id="${caseItem.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-secondary btn-small analyze-case" data-id="${caseItem.id}">
                                <i class="fas fa-robot"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
                
                document.getElementById('casesInfo').textContent = `عرض ${cases.length} من ${this.db.getCases().length} قضية`;
                
                // إضافة مستمعي الأحداث
                document.querySelectorAll('.view-case').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const caseId = e.currentTarget.dataset.id;
                        this.showCaseDetails(caseId);
                    });
                });
                
                document.querySelectorAll('.analyze-case').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const caseId = e.currentTarget.dataset.id;
                        this.analyzeCase(caseId);
                    });
                });
            }
            
            filterCases(filter) {
                // تحديث التبويبات النشطة
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                    if (tab.dataset.filter === filter) {
                        tab.classList.add('active');
                    }
                });
                
                // تحميل القضايا المصفاة
                this.loadAllCases(filter);
            }
            
            prepareNewCaseForm() {
                // توليد رقم قضية تلقائي
                const year = new Date().getFullYear();
                const randomNum = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
                const caseNumber = `${year}/CIV/${randomNum}`;
                
                document.getElementById('plaintiffName').focus();
                
                // تحميل قائمة القضاة
                this.loadJudgesForSelect();
            }
            
            loadJudgesForSelect() {
                const judges = this.db.getJudges();
                const select = document.getElementById('assignedJudge');
                
                // الحفاظ على الخيار الأول
                const firstOption = select.options[0];
                select.innerHTML = '';
                select.appendChild(firstOption);
                
                // إضافة القضاة
                judges.forEach(judge => {
                    const option = document.createElement('option');
                    option.value = judge.name;
                    option.textContent = judge.name;
                    select.appendChild(option);
                });
            }
            
            submitNewCase() {
                const caseData = {
                    caseNumber: this.generateCaseNumber(),
                    plaintiffName: document.getElementById('plaintiffName').value,
                    plaintiffId: document.getElementById('plaintiffId').value,
                    defendantName: document.getElementById('defendantName').value,
                    defendantId: document.getElementById('defendantId').value,
                    subject: document.getElementById('caseSubject').value,
                    description: document.getElementById('caseDescription').value,
                    type: document.getElementById('caseType').value,
                    priority: document.getElementById('casePriority').value,
                    assignedJudge: document.getElementById('assignedJudge').value || null,
                    attachments: this.uploadedFiles || []
                };
                
                try {
                    const newCase = this.db.addCase(caseData);
                    this.showToast('تم إضافة القضية بنجاح', 'success');
                    
                    // إعادة تعيين النموذج
                    document.getElementById('newCaseForm').reset();
                    document.getElementById('fileList').innerHTML = '';
                    this.uploadedFiles = [];
                    
                    // تحديث الإحصائيات
                    this.updateStats();
                    
                    // الانتقال إلى عرض القضية
                    this.showCaseDetails(newCase.id);
                    
                } catch (error) {
                    this.showToast('حدث خطأ أثناء حفظ القضية', 'danger');
                    console.error(error);
                }
            }
            
            saveCaseAsDraft() {
                this.showToast('تم حفظ القضية كمسودة', 'info');
            }
            
            generateCaseNumber() {
                const year = new Date().getFullYear();
                const cases = this.db.getCases();
                const civilCases = cases.filter(c => c.type === 'civil').length + 1;
                return `${year}/CIV/${civilCases.toString().padStart(3, '0')}`;
            }
            
            // ========== عرض تفاصيل القضية ==========
            
            showCaseDetails(caseId) {
                const caseItem = this.db.getCaseById(caseId);
                if (!caseItem) return;
                
                const modal = document.getElementById('caseDetailsModal');
                const title = document.getElementById('caseDetailsTitle');
                const content = document.getElementById('caseDetailsContent');
                
                title.textContent = `القضية: ${caseItem.caseNumber}`;
                
                content.innerHTML = `
                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">المدعي</label>
                                <div class="form-control">${caseItem.plaintiffName}</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label">المدعى عليه</label>
                                <div class="form-control">${caseItem.defendantName}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">موضوع القضية</label>
                        <div class="form-control">${caseItem.subject}</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">تفاصيل القضية</label>
                        <div class="form-control" style="min-height: 100px;">${caseItem.description}</div>
                    </div>
                    
                    <div class="row">
                        <div class="col-4">
                            <div class="form-group">
                                <label class="form-label">نوع القضية</label>
                                <div class="form-control">${this.getCaseTypeText(caseItem.type)}</div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="form-group">
                                <label class="form-label">الأولوية</label>
                                <div class="form-control">
                                    <span class="case-status ${this.getPriorityClass(caseItem.priority)}">
                                        ${this.getPriorityText(caseItem.priority)}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="form-group">
                                <label class="form-label">الحالة</label>
                                <div class="form-control">
                                    <span class="case-status ${this.getStatusClass(caseItem.status)}">
                                        ${this.getStatusText(caseItem.status)}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">القاضي المعين</label>
                        <div class="form-control">${caseItem.assignedJudge || 'غير معين'}</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">تاريخ الإنشاء</label>
                        <div class="form-control">${this.formatDate(caseItem.createdDate)}</div>
                    </div>
                    
                    ${caseItem.attachments && caseItem.attachments.length > 0 ? `
                        <div class="form-group">
                            <label class="form-label">المرفقات</label>
                            <div class="d-flex flex-column gap-1">
                                ${caseItem.attachments.map(file => `
                                    <div class="d-flex justify-between align-center p-2 border rounded">
                                        <div>
                                            <i class="fas fa-file-pdf text-danger"></i>
                                            ${file.name}
                                        </div>
                                        <div class="text-muted">${file.size}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${caseItem.sessions && caseItem.sessions.length > 0 ? `
                        <div class="form-group">
                            <label class="form-label">الجلسات</label>
                            <div class="d-flex flex-column gap-1">
                                ${caseItem.sessions.map(session => `
                                    <div class="d-flex justify-between align-center p-2 border rounded">
                                        <div>
                                            <strong>${session.type}</strong>
                                            <div class="text-muted">${this.formatDate(session.date)}</div>
                                        </div>
                                        <span class="badge ${session.status === 'مجدولة' ? 'badge-primary' : 'badge-secondary'}">
                                            ${session.status}
                                        </span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                `;
                
                // حفظ معرف القضية في أزرار الإجراءات
                modal.dataset.caseId = caseId;
                
                // إضافة مستمعي الأحداث للأزرار
                document.getElementById('editCaseBtn').onclick = () => {
                    this.editCase(caseId);
                };
                
                document.getElementById('analyzeCaseBtn').onclick = () => {
                    this.analyzeCase(caseId);
                };
                
                modal.classList.add('show');
            }
            
            editCase(caseId) {
                this.showToast('قريباً: ميزة تعديل القضية', 'info');
            }
            
            analyzeCase(caseId) {
                const caseItem = this.db.getCaseById(caseId);
                if (!caseItem) return;
                
                // الانتقال إلى تحليل القضايا
                this.switchView('ai-analysis');
                
                // تعيين نص التحليل
                document.getElementById('analysisText').value = `
القضية: ${caseItem.caseNumber}
المدعي: ${caseItem.plaintiffName}
المدعى عليه: ${caseItem.defendantName}
الموضوع: ${caseItem.subject}
التفاصيل: ${caseItem.description}
                `.trim();
                
                this.showToast(`جاهز لتحليل القضية ${caseItem.caseNumber}`, 'info');
            }
            
            // ========== إدارة القضاة ==========
            
            loadJudges() {
                const judges = this.db.getJudges();
                const container = document.getElementById('judgesList');
                
                if (judges.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-muted p-4">
                            <i class="fas fa-user-tie fa-3x mb-3"></i>
                            <p>لا توجد بيانات للقضاة</p>
                            <button class="btn btn-primary mt-2" id="addFirstJudge">
                                إضافة قاضٍ أول
                            </button>
                        </div>
                    `;
                    
                    document.getElementById('addFirstJudge')?.addEventListener('click', () => {
                        this.showAddJudgeModal();
                    });
                    
                    return;
                }
                
                container.innerHTML = `
                    <div class="table-responsive">
                        <table class="cases-table">
                            <thead>
                                <tr>
                                    <th>الاسم</th>
                                    <th>الدرجة</th>
                                    <th>المحكمة</th>
                                    <th>التخصصات</th>
                                    <th>القضايا النشطة</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${judges.map(judge => `
                                    <tr>
                                        <td><strong>${judge.name}</strong></td>
                                        <td>${this.getJudgeRankText(judge.rank)}</td>
                                        <td>${judge.court}</td>
                                        <td>
                                            <div class="d-flex flex-wrap gap-1">
                                                ${judge.specialties.map(spec => `
                                                    <span class="badge badge-secondary">
                                                        ${this.getSpecialtyText(spec)}
                                                    </span>
                                                `).join('')}
                                            </div>
                                        </td>
                                        <td>${judge.activeCases}</td>
                                        <td>
                                            <button class="btn btn-secondary btn-small edit-judge" data-id="${judge.id}">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-secondary btn-small view-judge-cases" data-id="${judge.id}">
                                                <i class="fas fa-gavel"></i>
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                
                // إضافة مستمعي الأحداث
                document.querySelectorAll('.edit-judge').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const judgeId = e.currentTarget.dataset.id;
                        this.editJudge(judgeId);
                    });
                });
                
                document.querySelectorAll('.view-judge-cases').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const judgeId = e.currentTarget.dataset.id;
                        this.viewJudgeCases(judgeId);
                    });
                });
            }
            
            showAddJudgeModal() {
                document.getElementById('addJudgeModal').classList.add('show');
            }
            
            hideAddJudgeModal() {
                document.getElementById('addJudgeModal').classList.remove('show');
                document.getElementById('judgeForm').reset();
            }
            
            saveJudge() {
                const judgeData = {
                    name: document.getElementById('judgeName').value,
                    rank: document.getElementById('judgeRank').value,
                    court: document.getElementById('judgeCourt').value,
                    specialties: Array.from(document.querySelectorAll('input[name="specialties"]:checked'))
                        .map(cb => cb.value),
                    email: document.getElementById('judgeEmail').value,
                    phone: document.getElementById('judgePhone').value
                };
                
                if (!judgeData.name || !judgeData.rank || !judgeData.court) {
                    this.showToast('الرجاء ملء جميع الحقول المطلوبة', 'warning');
                    return;
                }
                
                try {
                    this.db.addJudge(judgeData);
                    this.showToast('تم إضافة القاضٍ بنجاح', 'success');
                    this.hideAddJudgeModal();
                    this.loadJudges();
                } catch (error) {
                    this.showToast('حدث خطأ أثناء حفظ البيانات', 'danger');
                    console.error(error);
                }
            }
            
            editJudge(judgeId) {
                this.showToast('قريباً: ميزة تعديل بيانات القاضي', 'info');
            }
            
            viewJudgeCases(judgeId) {
                this.showToast('قريباً: ميزة عرض قضايا القاضي', 'info');
            }
            
            // ========== المساعد الذكي ==========
            
            setupChat() {
                this.chatHistory = JSON.parse(localStorage.getItem('rwaq_chat_history') || '[]');
            }
            
            loadChatHistory() {
                const container = document.getElementById('chatMessages');
                const history = this.chatHistory.slice(-10); // آخر 10 رسائل
                
                let html = `
                    <div class="ai-message assistant">
                        <strong>المساعد القانوني:</strong>
                        <p>مرحباً بك! أنا مساعدك القانوني الذكي. كيف يمكنني مساعدتك اليوم؟</p>
                    </div>
                `;
                
                history.forEach(msg => {
                    html += `
                        <div class="ai-message ${msg.sender}">
                            <strong>${msg.sender === 'user' ? 'أنت' : 'المساعد القانوني'}:</strong>
                            <p>${msg.content}</p>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                container.scrollTop = container.scrollHeight;
            }
            
            sendChatMessage() {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                
                if (!message) return;
                
                // إضافة رسالة المستخدم
                this.addChatMessage('user', message);
                input.value = '';
                
                // محاكاة استجابة الذكاء الاصطناعي
                setTimeout(() => {
                    const response = this.generateAIResponse(message);
                    this.addChatMessage('assistant', response);
                }, 1000);
            }
            
            addChatMessage(sender, content) {
                const message = { sender, content, timestamp: new Date().toISOString() };
                this.chatHistory.push(message);
                localStorage.setItem('rwaq_chat_history', JSON.stringify(this.chatHistory));
                
                this.loadChatHistory();
            }
            
            generateAIResponse(question) {
                const responses = {
                    'كيفية كتابة مذكرة دفاع': `كتابة مذكرة دفاع تتطلب الخطوات التالية:

1. **المقدمة**: بيان بيانات القضية والخصوم
2. **الوقائع**: سرد الوقائع بدقة ووضوح
3. **الدفوع**: عرض الدفوع الشكلية والموضوعية
4. **الطلبات**: صياغة الطلبات بشكل قانوني صحيح
5. **الخاتمة**: التوقيع والتاريخ

ينصح بمراعاة:
- الدقة في سرد الوقائع
- الاستشهاد بالنصوص القانونية
- الترتيب المنطقي للدفوع
- الوضوح في صياغة الطلبات`,

                    'ما هي إجراءات الطعن في الحكم': `إجراءات الطعن في الحكم تختلف حسب نوع الحكم:

**الاستئناف**:
1. تقديم مذكرة استئناف خلال 30 يوم
2. دفع الرسوم المقررة
3. إرفاق صورة من الحكم المطعون فيه

**النقض**:
1. تقديم عريضة نقض خلال 60 يوم
2. توافر أحد أسباب النقض
3. تقديم مذكرة بالأسباب

**التمييز**:
1. تقديم طلب التمييز خلال 15 يوم
2. بيان وجهة الخطأ في الحكم

ينصح بالاستعانة بمحامٍ متخصص في إجراءات الطعن.`,

                    'كيفية تحليل قضية مدنية': `تحليل القضية المدنية يتضمن:

**أولاً: تحليل الوقائع**
1. تحديد أطراف النزاع
2. سرد الوقائع التاريخية
3. تحديد محل النزاع

**ثانياً: البحث القانوني**
1. تحديد القواعد القانونية المنطبق
2. البحث في السوابق القضائية
3. دراسة الفقه القانوني

**ثالثاً: تقييم الأدلة**
1. تقييم قوة الأدلة المقدمة
2. تحديد الثغرات في الأدلة

**رابعاً: تقدير النتيجة**
1. تحليل نقاط القوة والضعف
2. تقدير احتمالات الفوز
3. تقدير التعويضات المحتملة`,

                    'ما هي مدة التقادم في القضايا التجارية': `مدة التقادم في القضايا التجارية:

1. **الدعاوى الناشئة عن عقود تجارية**: 10 سنوات
2. **الدعاوى الناشئة عن الكمبيالات**: 3 سنوات
3. **الدعاوى الناشئة عن الشيكات**: 5 سنوات
4. **الدعاوى المتعلقة بالأوراق التجارية**: 3 سنوات

**ملاحظات هامة**:
- تبدأ مدة التقادم من تاريخ استحقاق الحق
- يمكن قطع مدة التقادم بالإقرار أو الدعوى
- تختلف المدد باختلاف نوع الحق والعلاقة القانونية

ينصح بالرجوع للنظام التجاري السعودي والاستشارة القانونية المتخصصة.`
                };
                
                // البحث عن إجابة مناسبة
                for (const [key, value] of Object.entries(responses)) {
                    if (question.includes(key) || key.includes(question)) {
                        return value;
                    }
                }
                
                // إجابة افتراضية
                return `شكراً لسؤالك عن "${question}".

كمساعد قانوني ذكي، أنا هنا لمساعدتك في:
- تحليل القضايا القانونية
- كتابة المذكرات والمستندات
- البحث في السوابق القضائية
- الإجابة على الاستفسارات القانونية

للحصول على إجابة أكثر دقة، يرجى توفير المزيد من التفاصيل عن سؤالك.`;
            }
            
            askQuickQuestion(question) {
                document.getElementById('chatInput').value = question;
                this.sendChatMessage();
            }
            
            clearChat() {
                if (confirm('هل تريد مسح تاريخ المحادثة؟')) {
                    this.chatHistory = [];
                    localStorage.removeItem('rwaq_chat_history');
                    this.loadChatHistory();
                    this.showToast('تم مسح تاريخ المحادثة', 'success');
                }
            }
            
            // ========== تحليل القضايا ==========
            
            switchAnalysisTab(type) {
                // تحديث التبويبات النشطة
                document.querySelectorAll('[data-analysis-type]').forEach(tab => {
                    tab.classList.remove('active');
                    if (tab.dataset.analysisType === type) {
                        tab.classList.add('active');
                    }
                });
                
                // إظهار القسم المناسب
                document.querySelectorAll('.analysis-section').forEach(section => {
                    section.classList.add('d-none');
                });
                
                document.getElementById(`analysis-${type}`).classList.remove('d-none');
            }
            
            loadCasesForAnalysis() {
                const cases = this.db.getCases();
                const select = document.getElementById('caseSelect');
                
                // الحفاظ على الخيار الأول
                const firstOption = select.options[0];
                select.innerHTML = '';
                select.appendChild(firstOption);
                
                // إضافة القضايا
                cases.forEach(caseItem => {
                    const option = document.createElement('option');
                    option.value = caseItem.id;
                    option.textContent = `${caseItem.caseNumber} - ${caseItem.subject}`;
                    select.appendChild(option);
                });
                
                // إضافة مستمع حدث
                select.addEventListener('change', (e) => {
                    const caseId = e.target.value;
                    if (caseId) {
                        this.showSelectedCaseInfo(caseId);
                    } else {
                        document.getElementById('selectedCaseInfo').classList.add('d-none');
                    }
                });
            }
            
            showSelectedCaseInfo(caseId) {
                const caseItem = this.db.getCaseById(caseId);
                if (!caseItem) return;
                
                const container = document.getElementById('selectedCaseInfo');
                container.innerHTML = `
                    <div class="card mt-2">
                        <div class="card-body">
                            <h5>${caseItem.caseNumber}</h5>
                            <p class="text-muted">${caseItem.subject}</p>
                            <div class="d-flex justify-between">
                                <span>المدعي: ${caseItem.plaintiffName}</span>
                                <span>الحالة: ${this.getStatusText(caseItem.status)}</span>
                            </div>
                        </div>
                    </div>
                `;
                
                container.classList.remove('d-none');
            }
            
            startAnalysis() {
                const text = document.getElementById('analysisText').value.trim();
                const type = document.querySelector('.analysis-type.active')?.dataset.type || 'legal';
                
                if (!text) {
                    this.showToast('الرجاء إدخال نص للتحليل', 'warning');
                    return;
                }
                
                // عرض شريط التقدم
                this.showAnalysisProgress();
                
                // محاكاة التحليل
                setTimeout(() => {
                    const analysis = this.generateAnalysis(text, type);
                    this.showAnalysisResults(analysis);
                }, 2000);
            }
            
            showAnalysisProgress() {
                const resultsSection = document.getElementById('analysis-results');
                const content = document.getElementById('analysisResultsContent');
                
                content.innerHTML = `
                    <div class="text-center p-5">
                        <div class="loading-spinner mb-3"></div>
                        <h4>جاري تحليل القضية...</h4>
                        <p class="text-muted">قد تستغرق العملية بضع ثوانٍ</p>
                        <div class="progress-bar mt-3">
                            <div class="progress-fill" style="width: 0%" id="analysisProgress"></div>
                        </div>
                    </div>
                `;
                
                resultsSection.classList.remove('d-none');
                
                // محاكاة شريط التقدم
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 10;
                    const progressBar = document.getElementById('analysisProgress');
                    if (progressBar) {
                        progressBar.style.width = `${progress}%`;
                    }
                    
                    if (progress >= 100) {
                        clearInterval(interval);
                    }
                }, 200);
            }
            
            generateAnalysis(text, type) {
                const analyses = {
                    legal: {
                        title: 'تحليل قانوني',
                        sections: [
                            {
                                title: 'المسائل القانونية',
                                content: 'تم تحديد 3 مسائل قانونية رئيسية في القضية...'
                            },
                            {
                                title: 'النصوص القانونية المنطبقة',
                                content: '1. المادة ٤٥ من نظام المرافعات الشرعية...'
                            },
                            {
                                title: 'تقييم الأدلة',
                                content: 'قوة الأدلة: متوسطة، تحتاج إلى تدعيم...'
                            }
                        ]
                    },
                    procedural: {
                        title: 'تحليل الإجراءات القضائية',
                        sections: [
                            {
                                title: 'الإجراءات المطلوبة',
                                content: '1. تقديم طلب سماع شهود...'
                            },
                            {
                                title: 'الجدول الزمني المقترح',
                                content: 'الأسبوع ١: تقديم المذكرات...'
                            }
                        ]
                    },
                    precedent: {
                        title: 'بحث في السوابق القضائية',
                        sections: [
                            {
                                title: 'السوابق المشابهة',
                                content: 'تم العثور على ٥ سوابق قضائية مشابهة...'
                            }
                        ]
                    },
                    comprehensive: {
                        title: 'تحليل شامل',
                        sections: [
                            {
                                title: 'ملخص القضية',
                                content: 'القضية تتعلق بنزاع تعاقدي...'
                            },
                            {
                                title: 'نقاط القوة',
                                content: '1. وجود عقد مكتوب...'
                            },
                            {
                                title: 'نقاط الضعف',
                                content: '1. غياب بعض المستندات...'
                            },
                            {
                                title: 'التوصيات',
                                content: '1. جمع المستندات المفقودة...'
                            }
                        ]
                    }
                };
                
                return analyses[type] || analyses.legal;
            }
            
            showAnalysisResults(analysis) {
                const content = document.getElementById('analysisResultsContent');
                
                content.innerHTML = `
                    <div class="card-header">
                        <h4>${analysis.title}</h4>
                        <div class="text-muted">تاريخ التحليل: ${new Date().toLocaleDateString('ar-SA')}</div>
                    </div>
                    <div class="card-body">
                        ${analysis.sections.map(section => `
                            <div class="mb-4">
                                <h5>${section.title}</h5>
                                <div class="p-3 bg-dark rounded mt-2">
                                    ${section.content}
                                </div>
                            </div>
                        `).join('')}
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            هذا التحليل تم إنشاؤه آلياً ولا يغني عن الاستشارة القانونية المتخصصة.
                        </div>
                    </div>
                `;
                
                // إضافة مستمعي الأحداث للأزرار
                document.getElementById('exportAnalysis').onclick = () => {
                    this.exportAnalysis(analysis);
                };
                
                document.getElementById('printAnalysis').onclick = () => {
                    this.printAnalysis(analysis);
                };
            }
            
            exportAnalysis(analysis) {
                this.showToast('قريباً: ميزة تصدير التحليل', 'info');
            }
            
            printAnalysis(analysis) {
                this.showToast('قريباً: ميزة طباعة التحليل', 'info');
            }
            
            // ========== التحليل السريع ==========
            
            showQuickAnalysis() {
                document.getElementById('quickAnalysisModal').classList.add('show');
                document.getElementById('quickAnalysisText').focus();
            }
            
            hideQuickAnalysisModal() {
                document.getElementById('quickAnalysisModal').classList.remove('show');
                document.getElementById('quickAnalysisText').value = '';
            }
            
            runQuickAnalysis() {
                const text = document.getElementById('quickAnalysisText').value.trim();
                const type = document.getElementById('quickAnalysisType').value;
                
                if (!text) {
                    this.showToast('الرجاء إدخال نص للتحليل', 'warning');
                    return;
                }
                
                this.hideQuickAnalysisModal();
                this.switchView('ai-analysis');
                
                // تعيين النص ونوع التحليل
                document.getElementById('analysisText').value = text;
                document.querySelectorAll('.analysis-type').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.type === this.getAnalysisTypeFromQuick(type)) {
                        btn.classList.add('active');
                    }
                });
                
                // بدء التحليل
                setTimeout(() => {
                    this.startAnalysis();
                }, 500);
            }
            
            getAnalysisTypeFromQuick(quickType) {
                const mapping = {
                    'summary': 'comprehensive',
                    'issues': 'legal',
                    'procedures': 'procedural',
                    'recommendations': 'comprehensive'
                };
                
                return mapping[quickType] || 'legal';
            }
            
            // ========== التقارير ==========
            
            loadReports() {
                const container = document.getElementById('reportsContent');
                container.innerHTML = `
                    <div class="text-center p-5">
                        <i class="fas fa-chart-bar fa-3x mb-3 text-muted"></i>
                        <h4>التقارير والإحصائيات</h4>
                        <p class="text-muted">يتم تحضير لوحة التقارير المتقدمة</p>
                        <button class="btn btn-primary mt-3" id="generateSampleReport">
                            توليد تقرير تجريبي
                        </button>
                    </div>
                `;
                
                document.getElementById('generateSampleReport').addEventListener('click', () => {
                    this.generateSampleReport();
                });
            }
            
            generateSampleReport() {
                const stats = this.db.getStatistics();
                const cases = this.db.getCases();
                const judges = this.db.getJudges();
                
                const report = `
                    <div class="card">
                        <div class="card-header">
                            <h4>تقرير إحصائي - ${new Date().toLocaleDateString('ar-SA')}</h4>
                        </div>
                        <div class="card-body">
                            <div class="stats-grid mb-4">
                                <div class="stat-card">
                                    <div class="stat-value">${stats.totalCases}</div>
                                    <div class="stat-label">إجمالي القضايا</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">${stats.openCases}</div>
                                    <div class="stat-label">قضايا مفتوحة</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">${stats.urgentCases}</div>
                                    <div class="stat-label">قضايا عاجلة</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">${stats.totalJudges}</div>
                                    <div class="stat-label">عدد القضاة</div>
                                </div>
                            </div>
                            
                            <h5>توزيع القضايا حسب النوع</h5>
                            <div class="mt-3">
                                ${this.getCasesByType(cases)}
                            </div>
                            
                            <h5 class="mt-4">القضاة ونشاطهم</h5>
                            <div class="mt-3">
                                ${judges.map(judge => `
                                    <div class="d-flex justify-between align-center p-2 border-bottom">
                                        <div>${judge.name}</div>
                                        <div>${judge.activeCases} قضية نشطة</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('reportsContent').innerHTML = report;
            }
            
            getCasesByType(cases) {
                const types = {};
                cases.forEach(c => {
                    types[c.type] = (types[c.type] || 0) + 1;
                });
                
                return Object.entries(types).map(([type, count]) => `
                    <div class="d-flex justify-between align-center p-2 border-bottom">
                        <div>${this.getCaseTypeText(type)}</div>
                        <div>${count} قضية</div>
                    </div>
                `).join('');
            }
            
            // ========== رفع الملفات ==========
            
            setupFileUpload() {
                this.uploadedFiles = [];
                
                const dropZone = document.getElementById('fileDropZone');
                const fileInput = document.getElementById('fileInput');
                
                dropZone.addEventListener('click', () => {
                    fileInput.click();
                });
                
                fileInput.addEventListener('change', (e) => {
                    this.handleFiles(e.target.files);
                });
                
                dropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropZone.classList.add('dragover');
                });
                
                dropZone.addEventListener('dragleave', () => {
                    dropZone.classList.remove('dragover');
                });
                
                dropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropZone.classList.remove('dragover');
                    this.handleFiles(e.dataTransfer.files);
                });
            }
            
            handleFiles(files) {
                Array.from(files).forEach(file => {
                    if (file.size > 50 * 1024 * 1024) { // 50MB limit
                        this.showToast(`الملف ${file.name} يتجاوز الحد المسموح به (50MB)`, 'warning');
                        return;
                    }
                    
                    const fileData = {
                        name: file.name,
                        size: this.formatFileSize(file.size),
                        type: file.type,
                        file: file
                    };
                    
                    this.uploadedFiles.push(fileData);
                    this.updateFileList();
                });
            }
            
            updateFileList() {
                const container = document.getElementById('fileList');
                
                if (this.uploadedFiles.length === 0) {
                    container.innerHTML = '';
                    return;
                }
                
                container.innerHTML = `
                    <div class="card">
                        <div class="card-body">
                            <h6>الملفات المرفوعة</h6>
                            <div class="mt-2">
                                ${this.uploadedFiles.map((file, index) => `
                                    <div class="d-flex justify-between align-center p-2 border-bottom">
                                        <div>
                                            <i class="fas fa-file ${this.getFileIcon(file.type)}"></i>
                                            ${file.name}
                                        </div>
                                        <div class="d-flex gap-1">
                                            <span class="text-muted">${file.size}</span>
                                            <button class="btn btn-secondary btn-small remove-file" data-index="${index}">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
                
                // إضافة مستمعي الأحداث لأزرار الحذف
                document.querySelectorAll('.remove-file').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = parseInt(e.currentTarget.dataset.index);
                        this.uploadedFiles.splice(index, 1);
                        this.updateFileList();
                    });
                });
            }
            
            // ========== البحث ==========
            
            performSearch(query) {
                if (!query.trim()) return;
                
                const cases = this.db.getCases();
                const results = cases.filter(c => 
                    c.caseNumber.includes(query) ||
                    c.subject.includes(query) ||
                    c.plaintiffName.includes(query) ||
                    c.defendantName.includes(query)
                );
                
                if (results.length === 0) {
                    this.showToast('لم يتم العثور على نتائج', 'info');
                    return;
                }
                
                // الانتقال إلى عرض القضايا مع عرض النتائج
                this.switchView('cases');
                
                // تصفية وعرض النتائج
                const tbody = document.getElementById('allCasesBody');
                tbody.innerHTML = results.map(caseItem => `
                    <tr>
                        <td><strong>${caseItem.caseNumber}</strong></td>
                        <td>${caseItem.subject}</td>
                        <td>${caseItem.plaintiffName}</td>
                        <td>${caseItem.defendantName}</td>
                        <td>${this.formatDate(caseItem.createdDate)}</td>
                        <td>
                            <span class="case-status ${this.getStatusClass(caseItem.status)}">
                                ${this.getStatusText(caseItem.status)}
                            </span>
                        </td>
                        <td>${caseItem.assignedJudge || 'غير معين'}</td>
                        <td>
                            <button class="btn btn-secondary btn-small view-case" data-id="${caseItem.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
                
                document.getElementById('casesInfo').textContent = `عرض ${results.length} نتيجة بحث`;
                
                this.showToast(`تم العثور على ${results.length} نتيجة`, 'success');
            }
            
            // ========== دوال مساعدة ==========
            
            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('ar-SA');
            }
            
            formatFileSize(bytes) {
                if (bytes === 0) return '0 بايت';
                const k = 1024;
                const sizes = ['بايت', 'كيلوبايت', 'ميجابايت', 'جيجابايت'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
            }
            
            getFileIcon(fileType) {
                if (fileType.includes('pdf')) return 'fa-file-pdf text-danger';
                if (fileType.includes('word') || fileType.includes('document')) return 'fa-file-word text-primary';
                if (fileType.includes('excel') || fileType.includes('spreadsheet')) return 'fa-file-excel text-success';
                if (fileType.includes('image')) return 'fa-file-image text-info';
                return 'fa-file text-muted';
            }
            
            getStatusClass(status) {
                switch(status) {
                    case 'open': return 'status-open';
                    case 'in-progress': return 'status-in-progress';
                    case 'closed': return 'status-closed';
                    case 'urgent': return 'status-urgent';
                    default: return 'status-open';
                }
            }
            
            getStatusText(status) {
                switch(status) {
                    case 'open': return 'مفتوحة';
                    case 'in-progress': return 'قيد النظر';
                    case 'closed': return 'منتهية';
                    case 'urgent': return 'عاجلة';
                    default: return 'مفتوحة';
                }
            }
            
            getPriorityClass(priority) {
                switch(priority) {
                    case 'urgent': return 'status-urgent';
                    case 'high': return 'status-in-progress';
                    default: return 'status-open';
                }
            }
            
            getPriorityText(priority) {
                switch(priority) {
                    case 'urgent': return 'عاجلة';
                    case 'high': return 'متوسطة';
                    case 'normal': return 'عادية';
                    default: return 'عادية';
                }
            }
            
            getCaseTypeText(type) {
                const types = {
                    'civil': 'مدنية',
                    'commercial': 'تجارية',
                    'criminal': 'جنائية',
                    'administrative': 'إدارية',
                    'labor': 'عمالية',
                    'family': 'أحوال شخصية'
                };
                
                return types[type] || type;
            }
            
            getJudgeRankText(rank) {
                const ranks = {
                    'chief': 'رئيس محكمة',
                    'vice_chief': 'نائب رئيس',
                    'judge': 'قاضٍ',
                    'assistant': 'قاضٍ مساعد'
                };
                
                return ranks[rank] || rank;
            }
            
            getSpecialtyText(specialty) {
                const specialties = {
                    'civil': 'مدني',
                    'commercial': 'تجاري',
                    'criminal': 'جنائي',
                    'administrative': 'إداري',
                    'labor': 'عمّالي',
                    'family': 'أحوال شخصية'
                };
                
                return specialties[specialty] || specialty;
            }
            
            showToast(message, type = 'info') {
                const container = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                
                toast.className = `toast toast-${type}`;
                toast.innerHTML = `
                    <div class="d-flex align-center gap-2">
                        <i class="fas fa-${this.getToastIcon(type)}"></i>
                        <div>${message}</div>
                    </div>
                `;
                
                container.appendChild(toast);
                
                // إزالة التنبيه بعد 5 ثوانٍ
                setTimeout(() => {
                    toast.style.opacity = '0';
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.remove();
                        }
                    }, 300);
                }, 5000);
            }
            
            getToastIcon(type) {
                switch(type) {
                    case 'success': return 'check-circle';
                    case 'warning': return 'exclamation-triangle';
                    case 'danger': return 'times-circle';
                    case 'info': return 'info-circle';
                    default: return 'info-circle';
                }
            }
        }
        
        // ============================================
        // تهيئة التطبيق عند تحميل الصفحة
        // ============================================
        
        document.addEventListener('DOMContentLoaded', () => {
            window.app = new RwaqApp();
            
            // جعل التطبيق متاحاً عالمياً للاستكشاف
            console.log('رواق العدل - المنصة القانونية الذكية جاهزة للاستخدام');
            console.log('يمكنك الوصول إلى التطبيق عبر window.app');
            
            // إضافة مستمع حدث للشريط الجانبي على الأجهزة الصغيرة
            const sidebarToggle = document.createElement('button');
            sidebarToggle.className = 'btn btn-primary btn-small';
            sidebarToggle.innerHTML = '<i class="fas fa-bars"></i>';
            sidebarToggle.style.position = 'fixed';
            sidebarToggle.style.bottom = '20px';
            sidebarToggle.style.left = '20px';
            sidebarToggle.style.zIndex = '1000';
            
            sidebarToggle.addEventListener('click', () => {
                document.getElementById('sidebar').classList.toggle('show');
            });
            
            document.body.appendChild(sidebarToggle);
        });
        
        // ============================================
        // دالات للاستخدام من وحدة التحكم
        // ============================================
        
        // إضافة قضية تجريبية من وحدة التحكم
        window.addSampleCase = function() {
            if (!window.app) return;
            
            const caseData = {
                caseNumber: `TEST/${new Date().getFullYear()}/001`,
                plaintiffName: 'شركة الاختبار',
                plaintiffId: 'TEST001',
                defendantName: 'مؤسسة التجربة',
                defendantId: 'TEST002',
                subject: 'قضية تجريبية للنظام',
                description: 'هذه قضية تجريبية تم إنشاؤها لاختبار وظائف النظام',
                type: 'commercial',
                priority: 'normal',
                status: 'open',
                assignedJudge: 'القاضي أحمد محمد',
                attachments: []
            };
            
            const newCase = window.app.db.addCase(caseData);
            window.app.updateStats();
            window.app.showToast('تم إضافة قضية تجريبية', 'success');
            
            return newCase;
        };
        
        // عرض إحصائيات النظام من وحدة التحكم
        window.showStats = function() {
            if (!window.app) return;
            
            const stats = window.app.db.getStatistics();
            console.log('إحصائيات النظام:', stats);
            
            alert(`
إحصائيات رواق العدل:
- إجمالي القضايا: ${stats.totalCases}
- القضايا المفتوحة: ${stats.openCases}
- القضايا العاجلة: ${stats.urgentCases}
- القضايا المعينة لك: ${stats.assignedCases}
- عدد القضاة: ${stats.totalJudges}
- الإشعارات غير المقروءة: ${stats.unreadNotifications}
            `);
        };
        
        // تنظيف البيانات من وحدة التحكم
        window.resetData = function() {
            if (confirm('هل تريد حذف جميع البيانات وإعادة التهيئة؟')) {
                localStorage.clear();
                location.reload();
            }
        };
    </script>
</body>
</html>
