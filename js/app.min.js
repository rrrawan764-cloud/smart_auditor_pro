// ===== Justice Platform Application (رواق العدل) =====
class JusticePlatform {
    constructor() {
        this.currentMode = 'citizen';
        this.isDarkMode = true;
        this.isAuthenticated = false;
        this.user = null;
        this.isOnline = true;
        this.voiceSupported = 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window;
        this.init();
    }

    async init() {
        // 1. تشغيل شاشة التحميل (Splash Screen)
        await this.showSplashScreen();
        
        // 2. تهيئة الإعدادات والمحركات
        this.initEventListeners();
        this.loadPreferences();
        this.checkNetworkStatus();
        
        // 3. تحديث الواجهة
        this.updateUserInterface();
        
        // 4. رسالة الترحيب والجولة التعريفية
        setTimeout(() => {
            this.showNotification('مرحباً بك في رواق العدل', 'المنصة الذكية الشاملة للخدمات القضائية', 'info');
            this.showTourGuide();
        }, 1500);
    }

    // ===== شاشة التحميل =====
    async showSplashScreen() {
        const splash = document.getElementById('splashScreen');
        const progress = document.getElementById('loadingProgress');
        if (!splash || !progress) return;

        let progressValue = 0;
        return new Promise(resolve => {
            const interval = setInterval(() => {
                progressValue += Math.random() * 15;
                progress.style.width = `${Math.min(progressValue, 100)}%`;
                
                if (progressValue >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        splash.style.opacity = '0';
                        setTimeout(() => {
                            splash.style.display = 'none';
                            resolve();
                        }, 500);
                    }, 500);
                }
            }, 100);
        });
    }

    // ===== إدارة الأوضاع (مواطن، قاضي، محامي، مكفوفين) =====
    switchMode(mode, button) {
        this.currentMode = mode;
        
        // تحديث أزرار القائمة
        document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
        if (button) button.classList.add('active');
        
        // تحميل المحتوى الخاص بكل وضع
        this.loadModeContent(mode);
        this.savePreferences();
        this.showModeNotification(mode);
    }

    loadModeContent(mode) {
        const mainContainer = document.querySelector('.main-container');
        if (!mainContainer) return;

        const contents = {
            citizen: `<h2>واجهة المواطن</h2><p>أهلاً بك في خدمات الأفراد..</p>`,
            judge: `<h2>واجهة القاضي</h2><p>مرحباً فضيلة القاضي، إليك القضايا الحالية..</p>`,
            lawyer: `<h2>واجهة المحامي</h2><p>مكتبك الرقمي جاهز..</p>`,
            blind: `<h2>واجهة المكفوفين</h2><p>النظام الصوتي مفعل بالكامل الآن..</p>`
        };

        mainContainer.innerHTML = contents[mode] || contents.citizen;
    }

    // ===== المساعد الذكي (AI Assistant) =====
    toggleAssistant() {
        const chat = document.getElementById('assistantChat');
        if (chat) chat.style.display = chat.style.display === 'none' ? 'flex' : 'none';
    }

    // ===== التنبيهات وإعدادات الشبكة =====
    showNotification(title, message, type) {
        console.log(`[${type}] ${title}: ${message}`);
        // هنا يمكن إضافة كود لظهور Toast Notification
    }

    checkNetworkStatus() {
        this.isOnline = navigator.onLine;
        window.addEventListener('online', () => this.showNotification('تم الاتصال', 'أنت الآن متصل بالإنترنت', 'success'));
        window.addEventListener('offline', () => this.showNotification('تحذير', 'انقطع الاتصال بالإنترنت', 'warning'));
    }

    // ===== حفظ الإعدادات =====
    savePreferences() {
        localStorage.setItem('justicePrefs', JSON.stringify({
            mode: this.currentMode,
            darkMode: this.isDarkMode
        }));
    }

    loadPreferences() {
        const saved = JSON.parse(localStorage.getItem('justicePrefs'));
        if (saved) {
            this.currentMode = saved.mode || 'citizen';
            this.isDarkMode = saved.darkMode;
        }
    }

    initEventListeners() {
        // ربط أزرار الأوضاع
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', (e) => this.switchMode(e.target.dataset.mode, e.target));
        });

        // ربط زر المساعد
        const assistantBtn = document.getElementById('assistantToggle');
        if (assistantBtn) assistantBtn.addEventListener('click', () => this.toggleAssistant());
    }

    updateUserInterface() {
        this.loadModeContent(this.currentMode);
    }

    showTourGuide() {
        console.log('الجولة التعريفية بدأت');
    }
}

// تشغيل المنصة عند تحميل الصفحة
document.addEventListener('DOMContentLoaded', () => {
    window.platform = new JusticePlatform();
});
