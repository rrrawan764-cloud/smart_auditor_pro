<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>رواق العدل — منصة متكاملة</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    :root{
      --bg:#f4f7f3; --panel:#ffffff; --muted:#6b776f;
      --green:#116938; --gold:#FFB703; --shadow: 0 10px 30px rgba(11,20,14,0.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Cairo',sans-serif;background:var(--bg);color:#0b2a1a}
    .app{display:flex;gap:18px;padding:18px;min-height:100vh}
    aside.sidebar{width:300px;background:var(--panel);border-radius:12px;padding:18px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:12px}
    main{flex:1;display:flex;flex-direction:column;gap:12px}
    .logo{width:68px;height:68px;border-radius:12px;background:linear-gradient(180deg,var(--green),#0f5a31);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800}
    nav.menu{display:flex;flex-direction:column;gap:8px}
    .menu button{display:flex;align-items:center;gap:10px;padding:12px;border-radius:10px;border:none;background:transparent;cursor:pointer;color:var(--muted);text-align:right;font-family:inherit}
    .menu button.active{background:rgba(17,105,56,0.1);border-left:4px solid var(--gold);color:var(--green)}
    .card{background:var(--panel);border-radius:12px;padding:20px;box-shadow:var(--shadow);margin-bottom:15px}
    .btn{background:var(--green);color:#fff;border:none;padding:12px 20px;border-radius:10px;cursor:pointer;font-weight:700;font-family:inherit}
    .btn.secondary{background:var(--muted)}
    textarea, input{width:100%;padding:12px;border-radius:8px;border:1px solid rgba(0,0,0,0.1);margin-top:8px;font-family:inherit}
    .content-grid{display:grid;grid-template-columns:1fr 300px;gap:18px}
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">ر</div>
        <h2>رواق العدل</h2>
      </div>
      <nav class="menu">
        <button class="active" data-panel="assistant">المساعد الذكي</button>
        <button data-panel="casefile">قيد دعوى</button>
        <button data-panel="memo">تبادل مذكرات</button>
        <button data-panel="sessions">جلسات رقمية</button>
      </nav>
    </aside>

    <main>
      <div class="content-grid">
        <section id="panels">
          <article id="panel-assistant" class="card panel">
            <h2>المساعد الذكي</h2>
            <textarea id="facts" placeholder="اكتب ملخص الوقائع هنا..."></textarea>
            <button class="btn" id="runAi" style="margin-top:15px">تشغيل التدقيق الذكي</button>
            <div id="aiResult" style="margin-top:20px" hidden>
              <div class="card" id="analysisContent">جارٍ التحليل...</div>
            </div>
          </article>

          <article id="panel-casefile" class="card panel" hidden>
            <h2>قيد دعوى جديد</h2>
            <input id="plaintiff" placeholder="اسم المدعي">
            <input id="subject" placeholder="موضوع الدعوى">
            <textarea id="details" placeholder="تفاصيل الدعوى"></textarea>
            <button class="btn" id="submitCase" style="margin-top:15px">إرسال الطلب</button>
            <p id="caseFeedback" hidden></p>
          </article>
        </section>

        <aside>
          <div class="card">
            <h3>إحصائيات فورية</h3>
            <canvas id="judgeChart"></canvas>
          </div>
        </aside>
      </div>
    </main>
  </div>

  <script>
    const API_BASE = 'https://smart-auditor-pro.onrender.com/api';

    // التنقل بين القوائم
    function openPanel(name) {
      document.querySelectorAll('.panel').forEach(p => p.hidden = true);
      document.querySelectorAll('.menu button').forEach(b => b.classList.remove('active'));
      document.getElementById('panel-' + name).hidden = false;
      document.querySelector(`[data-panel="${name}"]`).classList.add('active');
    }

    document.querySelectorAll('.menu button').forEach(btn => {
      btn.onclick = () => openPanel(btn.dataset.panel);
    });

    // تشغيل AI الحقيقي
    document.getElementById('runAi').onclick = async () => {
      const facts = document.getElementById('facts').value;
      const content = document.getElementById('analysisContent');
      document.getElementById('aiResult').hidden = false;
      content.innerHTML = "جاري الاتصال بالسيرفر...";

      try {
        const res = await fetch(`${API_BASE}/ai/analyze`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text: facts })
        });
        const data = await res.json();
        content.innerHTML = `<strong>النتيجة:</strong> ${data.verdict}<br><strong>نصيحة:</strong> ${data.recommendations[0]}`;
      } catch (e) {
        content.innerHTML = "فشل الاتصال. تأكد أن سيرفر Render يعمل.";
      }
    };

    // قيد دعوى حقيقي
    document.getElementById('submitCase').onclick = async () => {
      const payload = {
        plaintiff: document.getElementById('plaintiff').value,
        subject: document.getElementById('subject').value,
        details: document.getElementById('details').value
      };
      try {
        const res = await fetch(`${API_BASE}/cases`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        alert("تم القيد بنجاح: " + data.id);
      } catch (e) { alert("خطأ في الاتصال"); }
    };

    // الرسم البياني
    new Chart(document.getElementById('judgeChart'), {
      type: 'doughnut',
      data: { labels: ['منجز', 'قيد'], datasets: [{ data: [300, 50], backgroundColor: ['#FFB703', '#116938'] }] }
    });
  </script>
</body>
</html>
