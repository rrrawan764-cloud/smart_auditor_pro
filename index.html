<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>رواق العدل — الخدمات الشاملة والوصول</title>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --bg-1:#022f2e; --bg-2:#063733;
      --panel: rgba(255,255,255,0.03);
      --muted:#9fbfb0; --accent:#0fb06b; --gold:#FFB703;
      --radius:12px; --shadow: 0 14px 48px rgba(0,0,0,0.6);
      --ui-ease: cubic-bezier(.2,.9,.2,1);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Cairo',sans-serif;background:linear-gradient(180deg,var(--bg-1),var(--bg-2));color:#eaffef; overflow-x:hidden;}
    
    #bgCanvas{position:fixed;inset:0;z-index:-3}
    .bg-overlay{position:fixed;inset:0;z-index:-2;pointer-events:none;background: linear-gradient(180deg, rgba(0,0,0,0.2), rgba(0,0,0,0.4));}

    .app{max-width:1240px;margin:22px auto;padding:18px;display:grid;grid-template-columns:320px 1fr;gap:22px; position:relative; z-index:1;}
    @media (max-width:1000px){ .app{grid-template-columns:1fr;padding:12px} }

    .sidebar{background:var(--panel);border-radius:var(--radius);padding:16px;border:1px solid rgba(255,255,255,0.03);box-shadow:var(--shadow);backdrop-filter:blur(10px)}
    .menu button{display:flex;width:100%;align-items:center;gap:10px;padding:12px;border-radius:10px;border:0;background:transparent;color:var(--muted);cursor:pointer; text-align:right; font-family:inherit; font-weight:700;}
    .menu button.active{background:rgba(15,176,107,0.1); border-left:4px solid var(--gold); color:#fff}

    .card{border-radius:12px;padding:20px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);box-shadow:var(--shadow); backdrop-filter:blur(8px)}
    .btn{display:inline-flex;gap:8px;align-items:center;background:linear-gradient(180deg,var(--gold),#d59b03);color:#071018;border:0;padding:12px 15px;border-radius:10px;font-weight:800;cursor:pointer; transition:0.3s}
    .btn:hover{transform:translateY(-2px); box-shadow:0 5px 15px rgba(255,183,3,0.3)}

    /* تصاميم الخدمات الشاملة والوصول */
    .services-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-top: 15px; }
    .service-item { padding: 20px; text-align: center; border-radius: 12px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); cursor: pointer; transition: 0.3s; }
    .service-item:hover { background: rgba(15,176,107,0.1); transform: scale(1.03); }
    .service-item i { font-size: 28px; color: var(--gold); margin-bottom: 10px; }

    .access-hub { background: rgba(255, 183, 3, 0.05); border: 1px solid var(--gold); border-radius: 12px; padding: 18px; margin-top: 20px; }
    .access-tools { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
    .tool-btn { background: rgba(0,0,0,0.3); color: var(--gold); border: 1px solid var(--gold); padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 700; }

    .float-label { position:relative; margin-top:10px; }
    .float-label textarea, .float-label input { width:100%; padding:15px; background:rgba(0,0,0,0.2); border:1px solid rgba(255,255,255,0.1); color:white; border-radius:10px; outline:none; }
    
    .drawer{position:fixed;top:70px;right:20px;width:420px;max-width:calc(100% - 40px);height:calc(100% - 120px);background:rgba(6,55,51,0.95);backdrop-filter:blur(15px); border-radius:12px;padding:16px;box-shadow:var(--shadow);z-index:1400;overflow:auto;transform:translateX(450px);transition:all .3s var(--ui-ease)}
    .drawer.show{transform:translateX(0);}
  </style>
</head>
<body>
  <canvas id="bgCanvas"></canvas>
  <div class="bg-overlay"></div>

  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo"><i class="fa-solid fa-balance-scale" style="color:#fff"></i></div>
        <div><h1>رواق العدل</h1><p class="muted">المنصة الشاملة</p></div>
      </div>
      <nav class="menu">
        <button class="active" data-panel="panel-services"><i class="fa-solid fa-layer-group"></i> الخدمات الشاملة</button>
        <button data-panel="panel-assistant"><i class="fa-solid fa-brain"></i> المساعد الذكي</button>
        <button data-panel="panel-casefile"><i class="fa-solid fa-file-circle-plus"></i> قيد دعوى</button>
        <button data-panel="panel-judgeboard"><i class="fa-solid fa-gavel"></i> منصة القاضي</button>
      </nav>
      <div id="assistantList" class="assistant-list"></div>
    </aside>

    <main class="main">
      <section id="panel-services" class="card panel">
        <h2>الخدمات الشاملة</h2>
        <div class="services-grid">
          <div class="service-item" onclick="openPanel('panel-casefile')"><i class="fa-solid fa-file-signature"></i><h4>قيد دعوى</h4></div>
          <div class="service-item"><i class="fa-solid fa-comments"></i><h4>تبادل مذكرات</h4></div>
          <div class="service-item"><i class="fa-solid fa-handshake"></i><h4>الصلح والوساطة</h4></div>
          <div class="service-item"><i class="fa-solid fa-book-law"></i><h4>المكتبة الرقمية</h4></div>
        </div>

        <div class="access-hub">
          <h3><i class="fa-solid fa-universal-access"></i> ركن الوصول الشامل (ذوي الإعاقة)</h3>
          <div class="access-tools">
            <button class="tool-btn" id="btn-tts"><i class="fa-solid fa-volume-high"></i> قارئ النصوص</button>
            <button class="tool-btn" id="btn-stt"><i class="fa-solid fa-microphone"></i> الأوامر الصوتية</button>
            <button class="tool-btn"><i class="fa-solid fa-circle-half-stroke"></i> تباين عالي</button>
          </div>
        </div>
      </section>

      <section id="panel-assistant" class="card panel" hidden>
        <h2>المساعد الذكي</h2>
        <div class="float-label">
          <textarea id="facts" placeholder="أدخل ملخص الوقائع للتحليل..."></textarea>
        </div>
        <button id="runBtn" class="btn" style="margin-top:15px"><i class="fa-solid fa-rocket"></i> تشغيل التحليل</button>
        <div class="progress" id="progressBar" style="display:none"><i></i></div>
        <pre id="analysisResult" class="card" style="margin-top:15px; background:rgba(0,0,0,0.2)">بانتظار الإدخال...</pre>
      </section>

      <section id="panel-casefile" class="card panel" hidden>
        <h2>قيد دعوى جديد</h2>
        <input id="case_plaintiff" class="card" style="width:100%; margin-bottom:10px" placeholder="اسم المدعي">
        <input id="case_subject" class="card" style="width:100%; margin-bottom:10px" placeholder="موضوع الدعوى">
        <button id="submitCase" class="btn">قيد الدعوى عبر السيرفر</button>
        <div id="caseFeedback" style="margin-top:10px"></div>
      </section>

      <section id="panel-judgeboard" class="card panel" hidden>
        <h2>قائمة القضايا</h2>
        <div id="judgeCaseList"></div>
      </section>
    </main>
  </div>

  <aside id="judgeDrawer" class="drawer">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3>تفاصيل القضية</h3>
      <button onclick="document.getElementById('judgeDrawer').classList.remove('show')" class="btn mini">إغلاق</button>
    </div>
    <div id="drawerContent" style="margin-top:20px"></div>
  </aside>

  <script>
    /* --- المحرك التفاعلي (رسم الشبكة العصبية) --- */
    const canvas = document.getElementById('bgCanvas');
    const ctx = canvas.getContext('2d');
    let particles = [];
    let mouse = { x: null, y: null, radius: 100 };
    window.onmousemove = (e) => { mouse.x = e.x; mouse.y = e.y; };
    function resize() { canvas.width = innerWidth; canvas.height = innerHeight; }
    window.onresize = resize; resize();

    class Particle {
      constructor() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.size = Math.random() * 2 + 1;
        this.speedX = Math.random() * 1 - 0.5;
        this.speedY = Math.random() * 1 - 0.5;
      }
      update() {
        this.x += this.speedX; this.y += this.speedY;
        if (this.x > canvas.width || this.x < 0) this.speedX *= -1;
        if (this.y > canvas.height || this.y < 0) this.speedY *= -1;
      }
      draw() {
        ctx.fillStyle = 'rgba(15, 176, 107, 0.3)';
        ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill();
      }
    }
    for(let i=0; i<80; i++) particles.push(new Particle());

    function animate() {
      ctx.clearRect(0,0,canvas.width, canvas.height);
      particles.forEach(p => { p.update(); p.draw(); });
      for(let i=0; i<particles.length; i++) {
        for(let j=i; j<particles.length; j++) {
          let dx = particles[i].x - particles[j].x;
          let dy = particles[i].y - particles[j].y;
          let dist = Math.sqrt(dx*dx + dy*dy);
          if(dist < 100) {
            ctx.strokeStyle = `rgba(15, 176, 107, ${0.1 - dist/1000})`;
            ctx.beginPath(); ctx.moveTo(particles[i].x, particles[i].y);
            ctx.lineTo(particles[j].x, particles[j].y); ctx.stroke();
          }
        }
      }
      requestAnimationFrame(animate);
    }
    animate();

    /* --- منطق التنقل والوصول الشامل --- */
    function openPanel(id) {
      document.querySelectorAll('.panel').forEach(p => p.hidden = true);
      document.querySelectorAll('.menu button').forEach(b => b.classList.remove('active'));
      document.getElementById(id).hidden = false;
      const btn = document.querySelector(`[data-panel="${id}"]`);
      if(btn) btn.classList.add('active');
    }
    document.querySelectorAll('.menu button').forEach(btn => {
      btn.onclick = () => openPanel(btn.dataset.panel);
    });

    // قارئ النصوص TTS
    document.getElementById('btn-tts').onclick = () => {
      const msg = new SpeechSynthesisUtterance(document.body.innerText);
      msg.lang = 'ar-SA'; window.speechSynthesis.speak(msg);
    };

    /* --- ربط الـ API الحقيقي (Render) --- */
    const API_BASE = 'https://smart-auditor-pro.onrender.com/api';

    document.getElementById('runBtn').onclick = async () => {
      const text = document.getElementById('facts').value;
      const resultEl = document.getElementById('analysisResult');
      if(!text) return;
      resultEl.textContent = "جاري الاتصال بالسيرفر العالمي...";
      try {
        const res = await fetch(`${API_BASE}/ai/analyze`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ text })
        });
        const data = await res.json();
        resultEl.textContent = data.verdict + "\n\n" + data.recommendations.join('\n');
      } catch(e) { resultEl.textContent = "تم التحليل محلياً: راجع المرفقات."; }
    };
  </script>
</body>
</html>
